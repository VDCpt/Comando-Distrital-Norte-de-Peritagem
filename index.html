<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VDC SISTEMA DE PERITAGEM FORENSE v12.6</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <!-- Tela de Carregamento -->
    <div id="loadingOverlay">
        <div class="loading-container">
            <div class="loading-logo">
                <i class="fas fa-search-dollar"></i>
                <h2>VDC PERITAGEM FORENSE v12.6</h2>
            </div>
            <div class="loading-progress">
                <div class="progress-bar">
                    <div id="loadingProgress" class="progress-fill"></div>
                </div>
                <p>Protocolo de Auditoria Final - Set-Dez 2024</p>
            </div>
            <div class="loading-info">
                <p><i class="fas fa-shield-alt"></i> Integridade de Dados Verificada</p>
                <p><i class="fas fa-calendar-alt"></i> Período Auditado: Setembro-Dezembro 2024</p>
            </div>
        </div>
    </div>

    <!-- Interface Principal -->
    <div id="mainContainer" class="container">
        <!-- Cabeçalho -->
        <header class="main-header">
            <div class="header-left">
                <div class="logo">
                    <i class="fas fa-search-dollar"></i>
                    <div>
                        <h1>VDC SISTEMA DE PERITAGEM FORENSE <span class="version-badge">v12.6</span></h1>
                        <p>Protocolo de Auditoria Final | Dados Auditados Set-Dez 2024</p>
                    </div>
                </div>
            </div>
            <div class="header-center">
                <div class="realtime-clock">
                    <i class="fas fa-clock"></i>
                    <span id="currentDate">01/01/2024</span>
                    <span class="time-separator">|</span>
                    <span id="currentTime" class="time-glow">00:00:00</span>
                </div>
            </div>
            <div class="header-right">
                <div class="master-hash">
                    <i class="fas fa-fingerprint"></i>
                    <div class="hash-display">
                        <span class="hash-label">INTEGRIDADE:</span>
                        <span id="masterHashValue" class="hash-glow">VDC-HASH-2024</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Área Principal -->
        <main class="main-content">
            <!-- Seção do Cliente -->
            <section class="client-section">
                <div class="section-header">
                    <h3><i class="fas fa-user-tie"></i> DADOS DO CLIENTE</h3>
                    <div id="clientStatus" class="status-badge" style="display: none;">
                        <i class="fas fa-check-circle"></i> CLIENTE REGISTADO
                    </div>
                </div>
                <div class="client-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="clientName"><i class="fas fa-user"></i> Nome Completo *</label>
                            <input type="text" id="clientName" placeholder="Ex: Unidade Pericial Forense, Lda">
                        </div>
                        <div class="form-group">
                            <label for="clientNIF"><i class="fas fa-id-card"></i> NIF *</label>
                            <input type="text" id="clientNIF" placeholder="9 dígitos">
                        </div>
                        <div class="form-group">
                            <label for="clientPhone"><i class="fas fa-phone"></i> Telefone</label>
                            <input type="text" id="clientPhone" placeholder="+351 XXX XXX XXX">
                        </div>
                        <div class="form-group">
                            <label for="clientEmail"><i class="fas fa-envelope"></i> Email</label>
                            <input type="email" id="clientEmail" placeholder="email@exemplo.pt">
                        </div>
                        <div class="form-group full-width">
                            <label for="clientAddress"><i class="fas fa-map-marker-alt"></i> Morada</label>
                            <input type="text" id="clientAddress" placeholder="Rua, Número, Código Postal, Localidade">
                        </div>
                    </div>
                    <div class="form-actions">
                        <button id="registerClientBtn" class="btn btn-primary">
                            <i class="fas fa-user-plus"></i> REGISTAR CLIENTE
                        </button>
                        <button id="saveClientBtn" class="btn btn-secondary">
                            <i class="fas fa-save"></i> GUARDAR DADOS
                        </button>
                        <div class="client-display" style="display: none;">
                            <p><i class="fas fa-user-check"></i> Cliente Ativo: <span id="clientNameDisplay">-</span></p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Seção de Upload -->
            <section class="upload-section">
                <div class="section-header">
                    <h3><i class="fas fa-file-upload"></i> CARREGAMENTO DE DOCUMENTOS</h3>
                    <div class="file-counters">
                        <span><i class="fas fa-file-code"></i> SAF-T: <span id="saftCount">0</span></span>
                        <span><i class="fas fa-file-invoice"></i> Faturas: <span id="invoiceCount">0</span></span>
                        <span><i class="fas fa-file-alt"></i> Extratos: <span id="statementCount">0</span></span>
                        <span><i class="fas fa-file-contract"></i> Total: <span id="totalCount">0</span></span>
                    </div>
                </div>
                
                <div class="upload-grid">
                    <!-- SAF-T -->
                    <div class="upload-card">
                        <div class="upload-icon">
                            <i class="fas fa-file-code"></i>
                        </div>
                        <h4>SAF-T (XML)</h4>
                        <p>Ficheiro SAF-T em formato XML</p>
                        <button id="saftFileBtn" class="btn btn-upload">
                            <i class="fas fa-upload"></i> CARREGAR SAF-T
                        </button>
                        <input type="file" id="saftFile" accept=".xml,.txt" style="display: none;">
                        <div id="saftFileList" class="file-list"></div>
                    </div>

                    <!-- Faturas -->
                    <div class="upload-card">
                        <div class="upload-icon">
                            <i class="fas fa-file-invoice"></i>
                        </div>
                        <h4>FATURAS (PDF)</h4>
                        <p>Faturas da plataforma digital</p>
                        <button id="invoiceFileBtn" class="btn btn-upload">
                            <i class="fas fa-upload"></i> CARREGAR FATURAS
                        </button>
                        <input type="file" id="invoiceFile" accept=".pdf,.txt" multiple style="display: none;">
                        <div id="invoiceFileList" class="file-list"></div>
                    </div>

                    <!-- Extratos -->
                    <div class="upload-card">
                        <div class="upload-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <h4>EXTRATOS (PDF/TXT)</h4>
                        <p>Extratos bancários ou da plataforma</p>
                        <button id="statementFileBtn" class="btn btn-upload">
                            <i class="fas fa-upload"></i> CARREGAR EXTRATOS
                        </button>
                        <input type="file" id="statementFile" accept=".pdf,.txt" multiple style="display: none;">
                        <div id="statementFileList" class="file-list"></div>
                    </div>

                    <!-- Controlo -->
                    <div class="upload-card">
                        <div class="upload-icon">
                            <i class="fas fa-file-contract"></i>
                        </div>
                        <h4>CONTROLO (TXT)</h4>
                        <p>Documento de controlo de validação</p>
                        <button id="controlFileBtn" class="btn btn-upload">
                            <i class="fas fa-upload"></i> CARREGAR CONTROLO
                        </button>
                        <input type="file" id="controlFile" accept=".txt" style="display: none;">
                        <div id="controlFileList" class="file-list"></div>
                    </div>
                </div>

                <!-- Botões de Ação -->
                <div class="action-buttons">
                    <button id="btnDemo" class="btn btn-demo">
                        <i class="fas fa-vial"></i> CARREGAR DADOS AUDITADOS 4 MESES
                    </button>
                    <button id="analyzeBtn" class="btn btn-analyze" disabled>
                        <i class="fas fa-search"></i> EXECUTAR ANÁLISE FORENSE
                    </button>
                    <div class="config-options">
                        <select id="selPlatform" class="select-custom">
                            <option value="bolt">Bolt</option>
                            <option value="uber">Uber</option>
                            <option value="freetaxi">FreeTaxi</option>
                            <option value="outra">Outra Plataforma</option>
                        </select>
                        <select id="selYear" class="select-custom"></select>
                    </div>
                </div>
            </section>

            <!-- Dashboard de Análise -->
            <section class="dashboard-section">
                <div class="section-header">
                    <h3><i class="fas fa-chart-line"></i> DASHBOARD DE ANÁLISE</h3>
                </div>
                
                <div class="kpi-section">
                    <div class="kpi-grid">
                        <!-- KPIs principais -->
                        <div class="kpi-card">
                            <div class="kpi-icon">
                                <i class="fas fa-euro-sign"></i>
                            </div>
                            <div class="kpi-content">
                                <h4>FATURAÇÃO BRUTA</h4>
                                <p id="kpiGanhos" class="kpi-value">0,00 €</p>
                                <small>Total faturado pela plataforma</small>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon">
                                <i class="fas fa-hand-holding-usd"></i>
                            </div>
                            <div class="kpi-content">
                                <h4>REPORTADO DAC7</h4>
                                <p id="kpiNet" class="kpi-value">0,00 €</p>
                                <small>Valor reportado para efeitos fiscais</small>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon">
                                <i class="fas fa-percentage"></i>
                            </div>
                            <div class="kpi-content">
                                <h4>COMISSÕES PLATAFORMA</h4>
                                <p id="kpiComm" class="kpi-value">0,00 €</p>
                                <small>Divergência identificada</small>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon">
                                <i class="fas fa-file-invoice"></i>
                            </div>
                            <div class="kpi-content">
                                <h4>FATURA PLATAFORMA</h4>
                                <p id="kpiInvoice" class="kpi-value">0,00 €</p>
                                <small>Valor das faturas processadas</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Valores Detalhados -->
                <div class="values-grid">
                    <div class="values-card">
                        <div class="values-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="values-content">
                            <h5>VALOR LÍQUIDO</h5>
                            <p id="netVal" class="values-value">0,00 €</p>
                        </div>
                    </div>
                    <div class="values-card">
                        <div class="values-icon">
                            <i class="fas fa-receipt"></i>
                        </div>
                        <div class="values-content">
                            <h5>IVA 6%</h5>
                            <p id="iva6Val" class="values-value">0,00 €</p>
                        </div>
                    </div>
                    <div class="values-card">
                        <div class="values-icon">
                            <i class="fas fa-cut"></i>
                        </div>
                        <div class="values-content">
                            <h5>COMISSÃO</h5>
                            <p id="commissionVal" class="values-value">0,00 €</p>
                        </div>
                    </div>
                    <div class="values-card">
                        <div class="values-icon">
                            <i class="fas fa-receipt"></i>
                        </div>
                        <div class="values-content">
                            <h5>IVA 23%</h5>
                            <p id="iva23Val" class="values-value">0,00 €</p>
                        </div>
                    </div>
                    <div class="values-card">
                        <div class="values-icon">
                            <i class="fas fa-gift"></i>
                        </div>
                        <div class="values-content">
                            <h5>CAMPANHAS</h5>
                            <p id="valCamp" class="values-value">0,00 €</p>
                        </div>
                    </div>
                    <div class="values-card">
                        <div class="values-icon">
                            <i class="fas fa-coins"></i>
                        </div>
                        <div class="values-content">
                            <h5>GORJETAS</h5>
                            <p id="valTips" class="values-value">0,00 €</p>
                        </div>
                    </div>
                    <div class="values-card">
                        <div class="values-icon">
                            <i class="fas fa-ban"></i>
                        </div>
                        <div class="values-content">
                            <h5>CANCELAMENTOS</h5>
                            <p id="valCanc" class="values-value">0,00 €</p>
                        </div>
                    </div>
                    <div class="values-card">
                        <div class="values-icon">
                            <i class="fas fa-road"></i>
                        </div>
                        <div class="values-content">
                            <h5>PORTAGENS</h5>
                            <p id="valPort" class="values-value">0,00 €</p>
                        </div>
                    </div>
                </div>

                <!-- IMT -->
                <div class="imt-section">
                    <h4><i class="fas fa-balance-scale"></i> CÁLCULO IMT</h4>
                    <div class="imt-grid">
                        <div class="imt-item">
                            <span>Base de Cálculo (Comissão):</span>
                            <span id="imtBase">0,00 €</span>
                        </div>
                        <div class="imt-item">
                            <span>Taxa IMT (5%):</span>
                            <span id="imtTax">0,00 €</span>
                        </div>
                        <div class="imt-item total">
                            <span>TOTAL PLATAFORMA:</span>
                            <span id="imtTotal">0,00 €</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Resultados e Projeção -->
            <section class="analysis-results">
                <div class="section-header">
                    <h3><i class="fas fa-chart-bar"></i> RESULTADOS DA ANÁLISE</h3>
                    <div id="omissionAlert" class="omission-alert" style="display: none;">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div>
                            <strong>ALERTA: DIVERGÊNCIA IDENTIFICADA</strong>
                            <p>Valor omitido: <span id="omissionValue">0,00 €</span></p>
                        </div>
                    </div>
                </div>

                <div class="results-grid">
                    <div class="result-card">
                        <h5>FATURAÇÃO BRUTA TOTAL</h5>
                        <div class="result-value" id="grossResult">0,00 €</div>
                        <div class="progress-bar">
                            <div class="bar-fill" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="result-card">
                        <h5>VALOR TRANSFERIDO (DAC7)</h5>
                        <div class="result-value" id="transferResult">0,00 €</div>
                        <div class="progress-bar">
                            <div class="bar-fill" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="result-card">
                        <h5>DIFERENÇA IDENTIFICADA</h5>
                        <div class="result-value" id="differenceResult">0,00 €</div>
                        <div class="progress-bar">
                            <div class="bar-fill" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="result-card">
                        <h5>PROJEÇÃO MERCADO (MENSAL)</h5>
                        <div class="result-value" id="marketResult">0,00M€</div>
                        <div class="progress-bar">
                            <div class="bar-fill" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <!-- DAC7 Input -->
                <div class="dac7-section">
                    <div class="dac7-input">
                        <label for="dac7Value"><i class="fas fa-file-contract"></i> VALOR REPORTADO DAC7:</label>
                        <input type="text" id="dac7Value" placeholder="Ex: 1000,00">
                        <button id="calcDAC7Btn" class="btn btn-secondary">
                            <i class="fas fa-calculator"></i> CALCULAR DISCREPÂNCIA
                        </button>
                    </div>
                    <div id="dac7Result" class="dac7-result" style="display: none;">
                        <i class="fas fa-search-dollar"></i>
                        <div>
                            <strong>RESULTADO DAC7</strong>
                            <p>Discrepância identificada: <span id="dac7Discrepancy">0,00 €</span></p>
                        </div>
                    </div>
                </div>

                <!-- Gráfico -->
                <div class="chart-container">
                    <canvas id="forensicChart"></canvas>
                </div>
            </section>

            <!-- Exportação -->
            <section class="export-section">
                <div class="section-header">
                    <h3><i class="fas fa-file-export"></i> EXPORTAÇÃO DE RESULTADOS</h3>
                </div>
                <div class="export-buttons">
                    <button id="exportPDFBtn" class="btn btn-export">
                        <i class="fas fa-file-pdf"></i> GERAR RELATÓRIO PDF (3 PÁGINAS)
                    </button>
                    <button id="exportJSONBtn" class="btn btn-export">
                        <i class="fas fa-file-code"></i> EXPORTAR JSON
                    </button>
                    <button id="clearDataBtn" class="btn btn-danger">
                        <i class="fas fa-trash-alt"></i> LIMPAR TODOS OS DADOS
                    </button>
                </div>
            </section>

            <!-- Console de Auditoria -->
            <section class="console-section">
                <div class="console-header">
                    <h3><i class="fas fa-terminal"></i> CONSOLE DE AUDITORIA</h3>
                    <div class="console-controls">
                        <button id="clearConsoleBtn" class="btn btn-small">
                            <i class="fas fa-broom"></i> LIMPAR
                        </button>
                        <button id="toggleConsoleBtn" class="btn btn-small">
                            <i class="fas fa-expand-alt"></i> EXPANDIR
                        </button>
                    </div>
                </div>
                <div id="auditOutput" class="console-output">
                    <!-- Logs aparecem aqui -->
                </div>
            </section>
        </main>

        <!-- Rodapé -->
        <footer class="main-footer">
            <p>VDC Sistema de Peritagem Forense v12.6 | Protocolo de Auditoria Final | Dados Auditados Set-Dez 2024</p>
            <p>© 2024 VDC Forensic Systems. Todos os direitos reservados.</p>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="script.js"></script>
</body>
</html>
