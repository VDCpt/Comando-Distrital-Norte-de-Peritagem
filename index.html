<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VDC | Sistema de Peritagem Forense v5.2 - Terminal de Prova Legal</title>
    
    <!-- Font Awesome (CDN Estável) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" 
          integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" 
          crossorigin="anonymous" referrerpolicy="no-referrer">
    
    <!-- CSS Local -->
    <link rel="stylesheet" href="style.css">
    
    <!-- Estilos de Modal de Acesso Controlado -->
    <style>
        /* Modal de Controlo de Acesso Pericial */
        .modal-access-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 99999;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }
        
        .modal-access-content {
            background: rgba(15, 23, 42, 0.95);
            padding: 50px;
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            border: 3px solid #3b82f6;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.9);
            color: #e2e8f0;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .modal-access-content h2 {
            color: #60a5fa;
            margin-bottom: 25px;
            font-size: 2.2rem;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        
        .modal-access-content .protocol-badge {
            display: inline-block;
            background: linear-gradient(90deg, #dc2626 0%, #ef4444 100%);
            color: white;
            padding: 10px 25px;
            border-radius: 30px;
            font-weight: bold;
            margin-bottom: 30px;
            font-size: 1.1rem;
            letter-spacing: 1px;
        }
        
        .modal-access-content .protocol-text {
            font-size: 1.2rem;
            line-height: 1.8;
            margin-bottom: 25px;
            text-align: left;
            padding: 20px;
            background: rgba(30, 64, 175, 0.1);
            border-radius: 10px;
            border-left: 4px solid #3b82f6;
        }
        
        .modal-access-content .security-warning {
            color: #f59e0b;
            font-size: 1rem;
            margin-top: 30px;
            padding: 15px;
            background: rgba(245, 158, 11, 0.1);
            border-radius: 8px;
            border: 1px solid #f59e0b;
        }
        
        .access-btn {
            background: linear-gradient(90deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 12px;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 30px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        
        .access-btn:hover {
            background: linear-gradient(90deg, #1d4ed8 0%, #1e40af 100%);
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(59, 130, 246, 0.5);
        }
        
        .access-btn i {
            font-size: 1.5rem;
        }
    </style>
</head>
<body>
    <!-- Modal de Controlo de Acesso Pericial (OBRIGATÓRIO) -->
    <div class="modal-access-overlay" id="modalAccessOverlay">
        <div class="modal-access-content">
            <h2><i class="fas fa-shield-alt"></i> PROTOCOLO DE SEGURANÇA E CUSTÓDIA DIGITAL V5.2</h2>
            <div class="protocol-badge">
                TERMINAL DE PROVA LEGAL - INTEGRIDADE ABSOLUTA
            </div>
            
            <div class="protocol-text">
                <p><strong>SISTEMA DE PERITAGEM FORENSE VDC - TERMINAL OPERACIONAL</strong></p>
                <p>Este terminal opera sob <strong>Validação Seletiva de Integridade NIST-2024</strong>. Processamento ancorado em funções criptográficas SHA-256 com isolamento de metadados (Filtro de Ruído Ativo).</p>
                <p>A sessão gerará uma <strong>Assinatura Digital Única Selada Temporalmente</strong>, baseada exclusivamente em ficheiros validados contra registo externo de autenticidade.</p>
                <p><strong>Princípio de Não Repúdio:</strong> Cada operação é registada em IndexedDB com timestamp criptográfico.</p>
            </div>
            
            <div class="security-warning">
                <i class="fas fa-exclamation-triangle"></i> 
                <strong>AVISO DE SEGURANÇA:</strong> Ficheiro de controlo excluído de cálculos de hash (FILTRO DE RUÍDO ATIVO). Processamento 100% local - sem transmissão de dados confidenciais.
            </div>
            
            <button class="access-btn" id="initProtocolBtn">
                <i class="fas fa-key"></i> AUTORIZAR ACESSO E INICIAR PROTOCOLO
            </button>
        </div>
    </div>

    <div class="container">
        <!-- Cabeçalho Pericial -->
        <header>
            <div class="header-top">
                <h1><i class="fas fa-balance-scale"></i> SISTEMA DE PERITAGEM FORENSE VDC v5.2</h1>
                <div class="vdc-banner">
                    <p class="vdc">VALIDAÇÃO SELETIVA DE INTEGRIDADE NIST-2024</p>
                    <h2>ASSINATURA DIGITAL DE SESSÃO</h2>
                </div>
            </div>
            
            <!-- SECÇÃO DE IDENTIFICAÇÃO PERICIAL (Hierarquia de Estados) -->
            <div class="config-section">
                <!-- Identificação do Perito/Cliente -->
                <div class="config-group">
                    <h4><i class="fas fa-user-shield"></i> IDENTIFICAÇÃO PERICIAL</h4>
                    <div class="config-inputs">
                        <input type="text" id="clientName" 
                               placeholder="Nome Completo do Cliente" 
                               title="Digite para buscar clientes existentes no histórico"
                               autocomplete="off"
                               data-state="pending">
                        <input type="text" id="clientNIF" 
                               placeholder="NIF (9 dígitos)"
                               title="Digite NIF para buscar cliente existente"
                               autocomplete="off"
                               data-state="pending"
                               pattern="\d{9}">
                        <button id="setClientBtn" class="config-btn" disabled>
                            <i class="fas fa-fingerprint"></i> REGISTAR CLIENTE
                        </button>
                    </div>
                </div>
                
                <!-- Período de Análise -->
                <div class="config-group">
                    <h4><i class="fas fa-calendar-alt"></i> PERÍODO DE ANÁLISE</h4>
                    <select id="yearSelect" class="config-select" disabled data-state="locked">
                        <option value="" disabled selected>SELECIONE O ANO</option>
                        <option value="2018">2018</option>
                        <option value="2019">2019</option>
                        <option value="2020">2020</option>
                        <option value="2021">2021</option>
                        <option value="2022">2022</option>
                        <option value="2023">2023</option>
                        <option value="2024" selected>2024</option>
                        <option value="2025">2025</option>
                        <option value="2026">2026</option>
                    </select>
                </div>
                
                <!-- Plataforma de Origem -->
                <div class="config-group">
                    <h4><i class="fas fa-mobile-alt"></i> PLATAFORMA DE ORIGEM</h4>
                    <select id="platformSelect" class="config-select" disabled data-state="locked">
                        <option value="" disabled selected>SELECIONE A PLATAFORMA</option>
                        <option value="bolt">Bolt (Estónia)</option>
                        <option value="uber">Uber (Holanda)</option>
                        <option value="uber_eats">Uber Eats (Holanda)</option>
                        <option value="bolt_food">Bolt Food (Estónia)</option>
                        <option value="glovo">Glovo (Espanha)</option>
                        <option value="outra">Outra Plataforma</option>
                    </select>
                </div>
                
                <!-- Status do Cliente (Feedback Estruturado) -->
                <div id="clientStatus" class="status-message" style="display: none;" data-state="inactive">
                    <i class="fas fa-user-check"></i> CLIENTE REGISTADO: 
                    <span id="currentClient" class="status-client-name">Aguardando...</span>
                    | EXERCÍCIO: <span id="currentYear" class="status-year">2024</span>
                    | ORIGEM: <span id="currentPlatform" class="status-platform">Bolt (Estónia)</span>
                </div>
            </div>
        </header>

        <main>
            <!-- SECÇÃO DE CONTROLO DE AUTENTICIDADE (Estado Bloqueado até Registro) -->
            <section class="control-section" id="controlSection" data-state="locked">
                <div class="control-header">
                    <div class="control-icon">
                        <i class="fas fa-key"></i>
                    </div>
                    <h3>
                        <i class="fas fa-database"></i> 1. REGISTO DE AUTENTICIDADE (.CSV) - VALIDAÇÃO PRIMÁRIA
                    </h3>
                </div>
                
                <div class="control-card">
                    <div class="file-input-container">
                        <input type="file" id="controlFile" accept=".csv,text/csv" class="file-input" disabled>
                        <label for="controlFile" class="file-label control-file-label" data-state="locked">
                            <i class="fas fa-cloud-upload-alt"></i> CARREGAR FICHEIRO DE CONTROLO (.CSV)
                            <span class="lock-status">
                                <i class="fas fa-lock"></i> AGUARDANDO IDENTIFICAÇÃO
                            </span>
                        </label>
                        <div class="file-info">
                            <i class="fas fa-info-circle"></i> Formato: "Algorithm","Hash","Path" - Ficheiro excluído de cálculos de hash (FILTRO DE RUÍDO)
                        </div>
                    </div>
                    
                    <!-- Status Estruturado -->
                    <div id="controlStatus" class="status-message" data-state="pending">
                        <i class="fas fa-clock"></i> AGUARDANDO FICHEIRO DE CONTROLO (VALIDAÇÃO PRIMÁRIA)
                    </div>
                    
                    <!-- DASHBOARD DE VALIDAÇÃO SELETIVA (Inicialmente Oculto) -->
                    <div id="controlHashDashboard" class="hash-dashboard" style="display: none;">
                        <h5>
                            <i class="fas fa-hashtag"></i> VALIDAÇÃO SELETIVA DE INTEGRIDADE
                        </h5>
                        <div class="data-grid dashboard-grid">
                            <!-- SAF-T -->
                            <div id="hash-saft-container" class="hash-container" data-state="pending">
                                <div class="data-item">
                                    <span>Ficheiro SAF-T:</span> 
                                    <span id="hash-saft-status" class="hash-status">AGUARDANDO</span>
                                </div>
                                <div id="hash-saft-ref" class="hash-value-ref" data-type="reference">-</div>
                                <div id="hash-saft-local" class="hash-value-ref" data-type="local" style="display: none;">-</div>
                            </div>
                            
                            <!-- Fatura -->
                            <div id="hash-fatura-container" class="hash-container" data-state="pending">
                                <div class="data-item">
                                    <span>Ficheiro Fatura:</span> 
                                    <span id="hash-fatura-status" class="hash-status">AGUARDANDO</span>
                                </div>
                                <div id="hash-fatura-ref" class="hash-value-ref" data-type="reference">-</div>
                                <div id="hash-fatura-local" class="hash-value-ref" data-type="local" style="display: none;">-</div>
                            </div>
                            
                            <!-- Extrato -->
                            <div id="hash-extrato-container" class="hash-container" data-state="pending">
                                <div class="data-item">
                                    <span>Ficheiro Extrato:</span> 
                                    <span id="hash-extrato-status" class="hash-status">AGUARDANDO</span>
                                </div>
                                <div id="hash-extrato-ref" class="hash-value-ref" data-type="reference">-</div>
                                <div id="hash-extrato-local" class="hash-value-ref" data-type="local" style="display: none;">-</div>
                            </div>
                            
                            <!-- Mensagem Inicial -->
                            <div id="no-files-message" class="no-files-message">
                                <i class="fas fa-info-circle"></i> Aguardando carregamento de documentos no Passo 2
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- CONSOLE DE AUDITORIA (Logs em Tempo Real) -->
            <section class="audit-console-section" id="auditConsole" style="display: none;">
                <div class="console-header">
                    <h4><i class="fas fa-terminal"></i> CONSOLE DE AUDITORIA</h4>
                    <button id="clearConsoleBtn" class="console-btn">
                        <i class="fas fa-broom"></i> LIMPAR
                    </button>
                </div>
                <div class="console-output" id="consoleOutput">
                    <!-- Logs serão injetados via JavaScript -->
                </div>
            </section>

            <!-- PAINEL DE UPLOADS DE DOCUMENTOS (Estados Hierárquicos) -->
            <section class="upload-section" id="documentUploadSection" data-state="locked">
                <!-- 2. SAF-T -->
                <div class="upload-card" data-type="saft" data-state="locked">
                    <div class="card-header">
                        <span class="step-number">2</span>
                        <h4><i class="fas fa-file-csv"></i> FICHEIRO SAF-T (CSV/XML)</h4>
                        <div class="validation-pill" id="saftStatusPill" data-state="pending">
                            <i class="fas fa-clock"></i> PENDENTE
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="file-input-container">
                            <input type="file" id="saftFile" accept=".csv,.xml,.txt,text/csv,application/xml" 
                                   class="file-input" disabled data-state="locked">
                            <label for="saftFile" class="file-label disabled" data-state="locked">
                                <i class="fas fa-cloud-upload-alt"></i> CARREGAR FICHEIRO SAF-T
                                <span class="lock-status">
                                    <i class="fas fa-lock"></i> AGUARDANDO VALIDAÇÃO
                                </span>
                            </label>
                        </div>
                        
                        <!-- Status Estruturado -->
                        <div class="file-status-container">
                            <div id="saftStatus" class="status-message" data-state="pending">
                                <i class="fas fa-clock"></i> AGUARDANDO VALIDAÇÃO DE AUTENTICIDADE
                            </div>
                            
                            <div class="hash-comparison" style="display: none;">
                                <div class="hash-row">
                                    <span class="hash-label">Hash Local (SHA-256):</span>
                                    <span id="saftHashCalculada" class="hash-value-display local" data-state="pending">-</span>
                                </div>
                                <div class="hash-row">
                                    <span class="hash-label">Hash de Referência:</span>
                                    <span id="saftHashOficial" class="hash-value-display official" data-state="pending">-</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Preview de Dados -->
                        <div class="data-preview" id="saftPreview" style="display: none;">
                            <h5><i class="fas fa-table"></i> METADADOS DO FICHEIRO SAF-T:</h5>
                            <div class="data-grid">
                                <div class="data-item"><span>Nome do Ficheiro:</span> <span id="saftFileName">-</span></div>
                                <div class="data-item"><span>Tamanho:</span> <span id="saftFileSize">-</span></div>
                                <div class="data-item"><span>Total de Registos:</span> <span id="saftRegistos">0</span></div>
                                <div class="data-item"><span>Ilíquido (Índice 14):</span> <span id="saftIliquido">0,00€</span></div>
                                <div class="data-item"><span>IVA 6% (Índice 13):</span> <span id="saftIVA">0,00€</span></div>
                                <div class="data-item"><span>Total (Índice 15):</span> <span id="saftBruto">0,00€</span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 3. Fatura Comissão -->
                <div class="upload-card" data-type="invoice" data-state="locked">
                    <div class="card-header">
                        <span class="step-number">3</span>
                        <h4><i class="fas fa-file-invoice-euro"></i> FATURA DE COMISSÃO</h4>
                        <div class="validation-pill" id="invoiceStatusPill" data-state="pending">
                            <i class="fas fa-clock"></i> PENDENTE
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="file-input-container">
                            <input type="file" id="invoiceFile" accept=".pdf,.txt,application/pdf" 
                                   class="file-input" disabled data-state="locked">
                            <label for="invoiceFile" class="file-label disabled" data-state="locked">
                                <i class="fas fa-cloud-upload-alt"></i> CARREGAR FATURA
                                <span class="lock-status">
                                    <i class="fas fa-lock"></i> AGUARDANDO VALIDAÇÃO
                                </span>
                            </label>
                        </div>
                        
                        <!-- Status Estruturado -->
                        <div class="file-status-container">
                            <div id="invoiceStatus" class="status-message" data-state="pending">
                                <i class="fas fa-clock"></i> AGUARDANDO VALIDAÇÃO DE AUTENTICIDADE
                            </div>
                            
                            <div class="hash-comparison" style="display: none;">
                                <div class="hash-row">
                                    <span class="hash-label">Hash Local (SHA-256):</span>
                                    <span id="invoiceHashCalculada" class="hash-value-display local" data-state="pending">-</span>
                                </div>
                                <div class="hash-row">
                                    <span class="hash-label">Hash de Referência:</span>
                                    <span id="invoiceHashOficial" class="hash-value-display official" data-state="pending">-</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Preview de Dados -->
                        <div class="data-preview" id="invoicePreview" style="display: none;">
                            <h5><i class="fas fa-receipt"></i> METADADOS DA FATURA:</h5>
                            <div class="data-grid">
                                <div class="data-item"><span>Nome do Ficheiro:</span> <span id="invoiceFileName">-</span></div>
                                <div class="data-item"><span>Tamanho:</span> <span id="invoiceFileSize">-</span></div>
                                <div class="data-item"><span>Referência Fatura:</span> <span id="invoiceReference">-</span></div>
                                <div class="data-item"><span>Total Faturado (EUR):</span> <span id="invoiceTotal">0,00€</span></div>
                                <div class="data-item"><span>IVA Estimado (23%):</span> <span id="invoiceIVA">0,00€</span></div>
                                <div class="data-item"><span>Regime de Autoliquidação:</span> <span id="invoiceRegime">Não identificado</span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 4. Extrato/Transferências -->
                <div class="upload-card" data-type="statement" data-state="locked">
                    <div class="card-header">
                        <span class="step-number">4</span>
                        <h4><i class="fas fa-file-invoice-dollar"></i> EXTRATO BANCÁRIO</h4>
                        <div class="validation-pill" id="statementStatusPill" data-state="pending">
                            <i class="fas fa-clock"></i> PENDENTE
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="file-input-container">
                            <input type="file" id="statementFile" 
                                   accept=".pdf,.jpg,.jpeg,.png,.csv,.txt,application/pdf,image/jpeg,image/png" 
                                   class="file-input" disabled data-state="locked">
                            <label for="statementFile" class="file-label disabled" data-state="locked">
                                <i class="fas fa-cloud-upload-alt"></i> CARREGAR EXTRATO
                                <span class="lock-status">
                                    <i class="fas fa-lock"></i> AGUARDANDO VALIDAÇÃO
                                </span>
                            </label>
                        </div>
                        
                        <!-- Status Estruturado -->
                        <div class="file-status-container">
                            <div id="statementStatus" class="status-message" data-state="pending">
                                <i class="fas fa-clock"></i> AGUARDANDO VALIDAÇÃO DE AUTENTICIDADE
                            </div>
                            
                            <div class="hash-comparison" style="display: none;">
                                <div class="hash-row">
                                    <span class="hash-label">Hash Local (SHA-256):</span>
                                    <span id="statementHashCalculada" class="hash-value-display local" data-state="pending">-</span>
                                </div>
                                <div class="hash-row">
                                    <span class="hash-label">Hash de Referência:</span>
                                    <span id="statementHashOficial" class="hash-value-display official" data-state="pending">-</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Preview de Dados -->
                        <div class="data-preview" id="statementPreview" style="display: none;">
                            <h5><i class="fas fa-bank"></i> METADADOS DO EXTRATO:</h5>
                            <div class="data-grid">
                                <div class="data-item"><span>Nome do Ficheiro:</span> <span id="statementFileName">-</span></div>
                                <div class="data-item"><span>Tamanho:</span> <span id="statementFileSize">-</span></div>
                                <div class="data-item"><span>Total Recebido:</span> <span id="totalRecebido">0,00€</span></div>
                                <div class="data-item"><span>Comissão da App (Real):</span> <span id="comissaoReal">0,00€</span></div>
                                <div class="data-item"><span>Ganhos Campanha:</span> <span id="ganhosCampanha">0,00€</span></div>
                                <div class="data-item"><span>Gorjetas:</span> <span id="gorjetas">0,00€</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- BOTÃO DE ANÁLISE FORENSE (Estado Controlado) -->
            <section class="analyze-section" id="analyzeSection" data-state="locked">
                <button id="analyzeBtn" class="analyze-btn" disabled data-state="locked">
                    <i class="fas fa-search"></i> EXECUTAR ANÁLISE FORENSE
                </button>
                <div class="progress-container" id="progressContainer" style="display: none;">
                    <div class="progress-bar" id="progressBar"></div>
                    <span class="progress-text" id="progressText">0%</span>
                </div>
            </section>

            <!-- RESULTADOS DA ANÁLISE (Renderização Dinâmica) -->
            <section class="analysis-section" id="analysisSection" style="display: none;">
                <!-- Conteúdo injetado via JavaScript -->
            </section>

            <!-- BOTÕES DE AÇÃO (Relatórios) -->
            <section class="action-buttons" id="actionButtons" style="display: none;">
                <button id="generateFullReportBtn" class="action-btn report-btn" disabled>
                    <i class="fas fa-file-pdf"></i> RELATÓRIO PERICIAL COMPLETO
                </button>
                <button id="generatePartialReportBtn" class="action-btn partial-btn" disabled>
                    <i class="fas fa-file-contract"></i> RELATÓRIO PARCIAL (SELEÇÃO)
                </button>
                <button id="saveAnalysisBtn" class="action-btn save-btn" disabled>
                    <i class="fas fa-save"></i> ARQUIVAR ANÁLISE COMPLETA
                </button>
            </section>

            <!-- RELATÓRIO DE CONFORMIDADE DO SISTEMA -->
            <section class="compliance-section">
                <div class="compliance-card">
                    <h4><i class="fas fa-certificate"></i> RELATÓRIO DE CONFORMIDADE DE SISTEMA PERICIAL</h4>
                    <div class="compliance-content">
                        <p><strong>Versão do Sistema:</strong> VDC v5.2 (Consolidada - Terminal de Prova Legal)</p>
                        <p><strong>Certificação de Processos:</strong> O sistema opera mediante o princípio da Integridade Absoluta. Cada bit de informação processado é submetido a uma verificação de redundância cíclica e hashing SHA-256. A interface foi desenhada para impedir a progressão de análises em caso de discrepância de dados sem o devido log de erro.</p>
                        <p><strong>Segurança de Dados:</strong> Não existe comunicação externa de dados confidenciais (NIFs, valores de faturação ou nomes de clientes). Todo o processamento é executado localmente na memória do navegador do perito, garantindo conformidade com o RGPD e o sigilo profissional de auditoria.</p>
                        
                        <div class="validators-grid">
                            <div class="validator-item">
                                <span class="validator-label">Algoritmos de Hashing:</span>
                                <span class="validator-value">SHA-256 (NIST compliant)</span>
                            </div>
                            <div class="validator-item">
                                <span class="validator-label">Parser de Dados:</span>
                                <span class="validator-value">PapaParse v5.3+ (Industrial grade)</span>
                            </div>
                            <div class="validator-item">
                                <span class="validator-label">Persistência:</span>
                                <span class="validator-value">IndexedDB (Browser-level sandboxed storage)</span>
                            </div>
                            <div class="validator-item">
                                <span class="validator-label">Validação:</span>
                                <span class="validator-value">Seletiva por Ficheiro (Non-repudiation)</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- FOOTER COM ASSINATURA DE SESSÃO -->
        <footer>
            <div class="footer-content">
                <p><i class="fas fa-shield-alt"></i> <strong>VDC - UNIDADE DE PERITAGEM FORENSE v5.2</strong> | TERMINAL DE PROVA LEGAL</p>
                <p class="timestamp">
                    <i class="fas fa-clock"></i> TIMESTAMP SISTEMA: 
                    <span id="currentTimestamp">carregando...</span> | 
                    SESSÃO ID: <span id="sessionId">-</span>
                </p>
                <p class="timestamp">
                    <i class="fas fa-database"></i> FILTRO DE RUÍDO ATIVO: FICHEIRO DE CONTROLO EXCLUÍDO DE CÁLCULOS DE HASH
                </p>
                <p class="timestamp">
                    <i class="fas fa-hashtag"></i> ASSINATURA DIGITAL DA SESSÃO: 
                    <br>
                    <span id="currentMasterHash" class="master-hash-footer">
                        AGUARDANDO GERAÇÃO DE ASSINATURA...
                    </span>
                </p>
                <p class="copyright">
                    © 2024-2026 VDC - VOZ DO CONDUTOR | SISTEMA DE PERITAGEM FISCAL COM VALIDAÇÃO SELETIVA NIST-2024
                </p>
            </div>
        </footer>
    </div>

    <!-- SCRIPTS EXTERNOS (CDNs Estáveis com Fallback) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- SCRIPT LOCAL (Lógica Pericial) -->
    <script src="script.js"></script>
    
    <!-- Fallback para CryptoJS caso CDN falhe -->
    <script>
        if (typeof CryptoJS === 'undefined') {
            document.write('<script src="lib/crypto-js.min.js"><\/script>');
            console.warn('CryptoJS CDN falhou, carregando localmente');
        }
        
        if (typeof Papa === 'undefined') {
            document.write('<script src="lib/papaparse.min.js"><\/script>');
            console.warn('PapaParse CDN falhou, carregando localmente');
        }
    </script>
</body>
</html>
