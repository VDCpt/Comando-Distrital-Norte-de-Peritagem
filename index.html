<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VDC FORENSE v15.1 ¬∑ SISTEMA DE PERITAGEM DIGITAL</title>
    
    <!-- Fontes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- CSS Principal -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- TELA DE LOGIN COM LASERS ANIMADOS -->
    <div id="login-screen" class="modal-overlay">
        <div class="laser-h"></div>
        <div class="laser-v"></div>
        <div class="panoramic-box">
            <div class="login-left">
                <div class="system-badge">‚öñÔ∏è v15.1 ELITE</div>
                <h1>VDC FORENSE SYSTEM</h1>
                <p class="protocol-text">Protocolo de Integridade Digital | Certifica√ß√£o ISO/IEC 27037 | NIST SP 800-86</p>
                <div class="legal-footer">FINAL LEGAL WEAPON ¬∑ CADEIA DE CUST√ìDIA</div>
            </div>

            <div class="login-right">
                <div class="form-group">
                    <label>N√çVEL DE ACESSO</label>
                    <select id="access-level" class="input-elite">
                        <option value="1">N√çVEL 1 - CONSULTA</option>
                        <option value="2">N√çVEL 2 - ANALISTA</option>
                        <option value="3">N√çVEL 3 - INVESTIGADOR</option>
                        <option value="4" selected>N√çVEL 4 - PERITO FORENSE</option>
                        <option value="5">N√çVEL 5 - ADMINISTRADOR</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>UTILIZADOR</label>
                    <input type="text" id="user" placeholder="ID PERITO" class="input-elite" value="admin">
                </div>
                <div class="form-group">
                    <label>PALAVRA-PASSE</label>
                    <input type="password" id="pass" placeholder="********" class="input-elite" value="vdc">
                </div>
            </div>
        </div>
        <div class="login-footer-action">
            <button onclick="VDC.validateLogin()" class="btn-main-validate">VALIDAR E INICIAR SESS√ÉO DE PERITAGEM</button>
            <div class="hash-display">SHA-256: <span id="auth-hash">e3b0c442...8b1a56</span></div>
        </div>
    </div>

    <!-- APLICA√á√ÉO PRINCIPAL (INICIALMENTE OCULTA) -->
    <main id="app-container" style="display:none;">
        <div class="container">
            <!-- HEADER PRINCIPAL -->
            <header class="forensic-header">
                <div class="header-left">
                    <div class="logo-area">
                        <span class="scale-small">‚öñÔ∏è</span>
                        <div class="titles">
                            <h1>FORENSIC ELITE EDITION v15.1</h1>
                            <p>ISO/IEC 27037 | NIST SP 800-86 | Cadeia de Cust√≥dia Digital</p>
                            <p>AMT / IMT Compliance | <strong>MOTOR BIG DATA ¬∑ SOMA INCREMENTAL</strong></p>
                        </div>
                    </div>
                </div>
                
                <div class="header-right">
                    <div class="info-block">
                        <label>N¬∫ PROCESSO (AUTO)</label>
                        <div id="autoProcessID" class="val-highlight">---</div>
                    </div>
                    <div class="info-block">
                        <label>SESS√ÉO</label>
                        <div id="sessionTimer" class="val-highlight">00:00:00</div>
                    </div>
                    <div class="info-block">
                        <label>HASH</label>
                        <div id="sessionHash" class="val-highlight">STANDBY</div>
                    </div>
                    <div class="status-online">
                        <span class="dot"></span>
                        <span class="text">ONLINE</span>
                    </div>
                </div>
            </header>

            <!-- METADADOS DA PER√çCIA -->
            <section class="audit-metadata">
                <div class="metadata-grid">
                    <div class="metadata-item">
                        <label>SUJEITO PASSIVO / EMPRESA</label>
                        <input type="text" id="subjectName" placeholder="Nome da Entidade" class="input-elite">
                    </div>
                    
                    <div class="metadata-item">
                        <label>NIPC / NIF</label>
                        <input type="text" id="nipc" placeholder="N√∫mero de Identifica√ß√£o Fiscal" class="input-elite" maxlength="9">
                    </div>
                    
                    <div class="metadata-item">
                        <label>PLATAFORMA TVDE</label>
                        <select id="platform" class="input-elite">
                            <option value="">-- SELECIONE A PLATAFORMA --</option>
                            <option value="uber">Uber B.V.</option>
                            <option value="bolt">Bolt Operations O√ú</option>
                            <option value="freenow">FreeNow Portugal</option>
                            <option value="outra">Outra Plataforma</option>
                        </select>
                        <div id="platformDetails" class="platform-details"></div>
                    </div>
                    
                    <div class="metadata-item">
                        <label>PER√çODO FISCAL</label>
                        <select id="fiscalPeriod" class="input-elite">
                            <option value="Anual">Anual</option>
                            <option value="1.¬∫ Trimestre">1.¬∫ Trimestre</option>
                            <option value="2.¬∫ Trimestre">2.¬∫ Trimestre</option>
                            <option value="3.¬∫ Trimestre">3.¬∫ Trimestre</option>
                            <option value="4.¬∫ Trimestre">4.¬∫ Trimestre</option>
                            <option value="Janeiro">Janeiro</option>
                            <option value="Fevereiro">Fevereiro</option>
                            <option value="Mar√ßo">Mar√ßo</option>
                        </select>
                    </div>
                    
                    <div class="metadata-item">
                        <label>ANO FISCAL</label>
                        <select id="fiscalYear" class="input-elite">
                            <!-- Options geradas por JS -->
                        </select>
                    </div>
                    
                    <div class="metadata-item">
                        <label>N¬∫ PROCESSO</label>
                        <input type="text" id="inputProcess" placeholder="Auto-gerado" class="input-elite" readonly>
                    </div>
                </div>
            </section>

            <!-- ZONA DE UPLOAD -->
            <section class="upload-zone" id="drop-zone">
                <div class="upload-content">
                    <div class="radar"></div>
                    <h3>FONTES DE DADOS ¬∑ BIG DATA UPLOAD</h3>
                    <p class="upload-text">Arraste ficheiros ou clique para selecionar</p>
                    <p class="upload-formats">Formatos suportados: PDF, CSV, XML, JSON (m√°x. 10MB)</p>
                    <p class="upload-limit">SAF-T (131509*.csv), Relat√≥rios DAC7, Faturas, Controlo de Autenticidade</p>
                    <div class="file-counters">
                        <span id="count-ctrl">CTRL: 0</span> | 
                        <span id="count-saft">SAF-T: 0</span> | 
                        <span id="count-fat">FAT: 0</span> | 
                        <span id="count-ext">EXT: 0</span> | 
                        <span id="count-dac7">DAC7: 0</span>
                    </div>
                    <input type="file" id="file-input" multiple accept=".pdf,.csv,.xml,.json,application/pdf,text/csv,application/json" hidden>
                </div>
            </section>

            <!-- FEEDBACK E LISTA DE FICHEIROS -->
            <div id="file-feedback" class="file-feedback"></div>
            <div id="file-queue" class="file-list"></div>

            <!-- M√âTRICAS PRINCIPAIS -->
            <div class="metrics-grid">
                <div class="stat-card">
                    <label>RECEITA BRUTA (SAF-T)</label>
                    <div class="value-wrapper">
                        <span class="val" id="val-bruto">0,00</span>
                        <span class="currency">‚Ç¨</span>
                    </div>
                    <div class="trend" id="trendSaft">‚ü∑ 0%</div>
                </div>
                
                <div class="stat-card">
                    <label>COMISS√ïES TOTAIS</label>
                    <div class="value-wrapper">
                        <span class="val" id="val-comissoes">0,00</span>
                        <span class="currency">‚Ç¨</span>
                    </div>
                    <div class="trend" id="trendComissoes">‚ü∑ 0%</div>
                </div>
                
                <div class="stat-card">
                    <label>RECEITA ANUAL (DAC7)</label>
                    <div class="value-wrapper">
                        <span class="val" id="val-dac7">0,00</span>
                        <span class="currency">‚Ç¨</span>
                    </div>
                    <div class="trend" id="trendDac7">‚ü∑ 0%</div>
                </div>
                
                <div class="stat-card highlight" id="cardDivergencia">
                    <label>DIVERG√äNCIA (SAF-T - DAC7)</label>
                    <div class="value-wrapper">
                        <span class="val" id="val-divergencia">0,00</span>
                        <span class="currency">‚Ç¨</span>
                    </div>
                    <div class="trend" id="trendDivergencia">‚ü∑ 0%</div>
                </div>
            </div>

            <!-- M√âTRICAS SECUND√ÅRIAS -->
            <div class="secondary-metrics">
                <div class="metric-small">
                    <label>N¬∫ VIAGENS</label>
                    <span class="val" id="val-viagens">0</span>
                </div>
                <div class="metric-small">
                    <label>GANHOS L√çQUIDOS</label>
                    <span class="val" id="val-liquido">0,00</span>
                    <span class="currency">‚Ç¨</span>
                </div>
                <div class="metric-small">
                    <label>TAXA M√âDIA</label>
                    <span class="val" id="val-taxa">0,00</span>
                    <span class="currency">%</span>
                </div>
                <div class="metric-small">
                    <label>DOCUMENTOS</label>
                    <span class="val" id="doc-count">0</span>
                </div>
            </div>

            <!-- PAINEL DE CONTROLO -->
            <div class="control-panel">
                <div class="action-bar">
                    <button id="btn-analyze" class="btn-main">
                        <span>üîç EXECUTAR CRUZAMENTOS ARITM√âTICOS</span>
                    </button>
                    
                    <button id="btn-export-pdf" class="btn-sec">
                        <span>üìÑ GERAR PROVA LEGAL (PDF)</span>
                    </button>
                    
                    <button id="btn-export-json" class="btn-sec">
                        <span>üìä EXPORTAR JSON</span>
                    </button>
                    
                    <button id="btn-demo" class="btn-sec demo">
                        <span>üöÄ CARREGAR DEMO</span>
                    </button>
                    
                    <button id="btn-clear" class="btn-sec danger">
                        <span>üóëÔ∏è LIMPAR SISTEMA</span>
                    </button>
                </div>
            </div>

            <!-- TABS DE RESULTADOS -->
            <div class="tabs-container">
                <div class="tabs">
                    <button class="tab-btn active" data-tab="tab-autenticidade">CONTROLO DE AUTENTICIDADE</button>
                    <button class="tab-btn" data-tab="tab-financeiro">CRUZAMENTO FINANCEIRO</button>
                    <button class="tab-btn" data-tab="tab-dac7">RELAT√ìRIO DAC7</button>
                    <button class="tab-btn" data-tab="tab-veredito">VEREDITO FISCAL</button>
                </div>

                <!-- TAB 1: AUTENTICIDADE -->
                <div class="tab-content" id="tab-autenticidade">
                    <div class="table-wrapper">
                        <table id="table-hashes">
                            <thead>
                                <tr>
                                    <th>ALGORITMO</th>
                                    <th>HASH CALCULADO (SHA-256)</th>
                                    <th>FICHEIRO ORIGEM</th>
                                    <th>ESTADO</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <!-- TAB 2: FINANCEIRO -->
                <div class="tab-content hidden" id="tab-financeiro">
                    <div class="table-wrapper">
                        <table id="table-viagens">
                            <thead>
                                <tr>
                                    <th>DATA</th>
                                    <th>MOTORISTA</th>
                                    <th>N.¬∫ FATURA</th>
                                    <th>VALOR (‚Ç¨)</th>
                                    <th>COMISS√ÉO (‚Ç¨)</th>
                                    <th>TAXA</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    
                    <!-- √ÅREA DE ALERTAS CR√çTICOS -->
                    <div class="alerts-section">
                        <h4>ALERTAS DE DISCREP√ÇNCIA</h4>
                        <div id="alertas-container" class="alertas-container"></div>
                    </div>

                    <div class="triangulacao-financeira">
                        <h4>TRIANGULA√á√ÉO FINANCEIRA - VERDADE MATERIAL</h4>
                        <div class="triangulacao-grid">
                            <div class="tri-item"><span>BRUTO APP</span><strong id="tri-bruto">0,00 ‚Ç¨</strong></div>
                            <div class="tri-item"><span>COMISS√ïES</span><strong id="tri-comissoes">0,00 ‚Ç¨</strong></div>
                            <div class="tri-item"><span>PROVEITO REAL</span><strong id="tri-liquido">0,00 ‚Ç¨</strong></div>
                            <div class="tri-item"><span>FATURADO</span><strong id="tri-faturado">0,00 ‚Ç¨</strong></div>
                            <div class="tri-item" id="tri-discrepancia-item" style="display: none;"><span>DISCREP√ÇNCIA</span><strong id="tri-discrepancia">0,00 ‚Ç¨</strong></div>
                        </div>
                    </div>
                    
                    <div class="cruzamentos-detalhe">
                        <h4>RESULTADOS DOS CRUZAMENTOS</h4>
                        <div class="cruzamento-item"><span class="cruzamento-label">SAF-T vs DAC7:</span><span class="cruzamento-status" id="status-saft-dac7">A aguardar dados</span></div>
                        <div class="cruzamento-item"><span class="cruzamento-label">Bruto vs Ganhos App:</span><span class="cruzamento-status" id="status-bruto-extrato">A aguardar dados</span></div>
                        <div class="cruzamento-item"><span class="cruzamento-label">Comiss√µes vs Faturas:</span><span class="cruzamento-status" id="status-comissoes-faturas">A aguardar dados</span></div>
                    </div>
                </div>

                <!-- TAB 3: DAC7 -->
                <div class="tab-content hidden" id="tab-dac7">
                    <div class="dac7-container">
                        <div class="dac7-header">
                            <h4>DECLARA√á√ÉO ANUAL ¬∑ DIRETIVA DAC7</h4>
                            <span class="dac7-badge">ART. 6.¬∫</span>
                        </div>
                        <div class="dac7-content">
                            <div class="dac7-row"><span>RECEITA TOTAL DECLARADA:</span><strong id="dac7-receita">0,00 ‚Ç¨</strong></div>
                            <div class="dac7-row"><span>COMISS√ïES TOTAIS:</span><strong id="dac7-comissoes">0,00 ‚Ç¨</strong></div>
                            <div class="dac7-row"><span>SERVI√áOS PRESTADOS:</span><strong id="dac7-servicos">0</strong></div>
                            <div class="dac7-row"><span>PER√çODO DECLARADO:</span><strong id="dac7-periodo">2024</strong></div>
                        </div>
                        <div class="dac7-trimestres">
                            <h5>DETALHES TRIMESTRAIS</h5>
                            <div class="trimestres-grid">
                                <div class="trimestre-card"><span class="trimestre-label">1.¬∫ TRIMESTRE</span><span class="trimestre-value" id="dac7-1t">0,00 ‚Ç¨</span></div>
                                <div class="trimestre-card"><span class="trimestre-label">2.¬∫ TRIMESTRE</span><span class="trimestre-value" id="dac7-2t">0,00 ‚Ç¨</span></div>
                                <div class="trimestre-card"><span class="trimestre-label">3.¬∫ TRIMESTRE</span><span class="trimestre-value" id="dac7-3t">0,00 ‚Ç¨</span></div>
                                <div class="trimestre-card"><span class="trimestre-label">4.¬∫ TRIMESTRE</span><span class="trimestre-value" id="dac7-4t">0,00 ‚Ç¨</span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAB 4: VEREDITO -->
                <div class="tab-content hidden" id="tab-veredito">
                    <div class="veredicto-section" id="veredicto-section">
                        <div class="veredicto-header">
                            <h2>VEREDITO FISCAL ¬∑ TRIANGULA√á√ÉO</h2>
                            <div class="veredicto-status" id="veredicto-status">NORMAL</div>
                            <div class="veredicto-desvio" id="veredicto-desvio">Sem desvios significativos</div>
                        </div>
                        <div class="anomalia-critica" id="anomalia-critica" style="display: none;">
                            <span class="icon-warning">‚ö†Ô∏è</span>
                            <div>
                                <strong>ANOMALIA CR√çTICA DETETADA</strong>
                                <p id="anomalia-texto">Potencial incumprimento fiscal (Art. 103.¬∫ RGIT)</p>
                                <span class="valor-anomalia" id="valor-anomalia">0,00 ‚Ç¨</span>
                            </div>
                        </div>
                        <div class="recomendacoes">
                            <h4>RECOMENDA√á√ïES T√âCNICAS</h4>
                            <ul id="recomendacoes-lista">
                                <li>Validar concilia√ß√£o banc√°ria dos valores declarados</li>
                                <li>Verificar reten√ß√µes na fonte e IVA</li>
                                <li>Confrontar valores com extratos banc√°rios</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MASTER HASH E QR CODE -->
            <div class="master-hash-container">
                <div class="master-hash-left">
                    <span class="master-label">MASTER HASH SHA-256:</span>
                    <span class="master-value" id="master-hash">---</span>
                </div>
                <div class="master-hash-right">
                    <div id="qrcode-container" style="width: 64px; height: 64px;"></div>
                    <span class="timestamp" id="footerTimestamp"></span>
                    <span class="session-id" id="footer-session">---</span>
                </div>
            </div>

            <!-- FOOTER -->
            <footer class="main-footer">
                <div class="footer-left">
                    <span class="copyright">VDC FORENSE ELITE v15.1 ¬∑ Todos os direitos reservados</span>
                </div>
                <div class="footer-right">
                    <span class="system-status">ESTADO: <span id="system-status" class="status-ok">OPERACIONAL</span></span>
                    <span class="chain-status">CADEIA DE CUST√ìDIA: <span id="chain-status" class="status-ok">√çNTEGRA</span></span>
                </div>
            </footer>
        </div>
    </main>

    <!-- Scripts Externos -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <script>
        window.pdfjsLib = window.pdfjsLib || {};
        window.pdfjsLib.GlobalWorkerOptions = window.pdfjsLib.GlobalWorkerOptions || {};
        window.pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
    </script>

    <!-- JavaScript Principal -->
    <script src="script.js"></script>
</body>
</html>
