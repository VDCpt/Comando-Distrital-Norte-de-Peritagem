<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VDC | Sistema de Peritagem Forense v6.0</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@300;400&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Overlay de Carregamento -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner">
                <i class="fas fa-fingerprint fa-spin"></i>
            </div>
            <h2>VDC SISTEMA DE PERITAGEM FORENSE v6.0</h2>
            <p>Big Data Forense | Análise Fiscal Automatizada</p>
            <div class="loading-progress">
                <div class="loading-progress-bar" id="loadingProgress"></div>
            </div>
        </div>
    </div>

    <!-- Conteúdo Principal -->
    <div id="mainContainer" class="main-container" style="display: none;">
        
        <!-- Cabeçalho -->
        <header class="main-header">
            <div class="header-content">
                <div class="logo-section">
                    <i class="fas fa-balance-scale"></i>
                    <div>
                        <h1>VDC FORENSIC SYSTEM <span class="version-badge">v6.0</span></h1>
                        <p class="subtitle">Big Data Forense | Análise de Evasão Fiscal</p>
                    </div>
                </div>
                <div class="session-info">
                    <div class="system-controls">
                        <div class="control-group">
                            <label for="selYear"><i class="fas fa-calendar-alt"></i> Ano Fiscal</label>
                            <select id="selYear" class="year-select">
                                <!-- Preenchido dinamicamente -->
                            </select>
                        </div>
                        <div class="control-group">
                            <label for="selPlatform"><i class="fas fa-globe-europe"></i> Plataforma</label>
                            <select id="selPlatform" class="platform-select">
                                <option value="bolt">Bolt (Estónia) - IVA Autoliquidação</option>
                                <option value="uber">Uber (Holanda) - IVA Autoliquidação</option>
                                <option value="other">Outra Plataforma</option>
                            </select>
                        </div>
                    </div>
                    <div class="timestamp">
                        <i class="fas fa-clock"></i>
                        <span id="currentTime">00:00:00</span>
                        <span class="session-id">Sessão: <strong id="sessionIdDisplay">VDC-XXXXXX</strong></span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Dashboard de Estatísticas -->
        <section class="dashboard-stats">
            <div class="stat-box">
                <h4><i class="fas fa-file-invoice"></i> BRUTO SAF-T</h4>
                <p id="grossVal">0.00€</p>
                <small>Faturação total declarada</small>
            </div>
            <div class="stat-box">
                <h4><i class="fas fa-percentage"></i> IVA 6%</h4>
                <p id="iva6Val">0.00€</p>
                <small>Taxa reduzida Portugal</small>
            </div>
            <div class="stat-box">
                <h4><i class="fas fa-hand-holding-usd"></i> TRANSFERÊNCIA</h4>
                <p id="transferVal">0.00€</p>
                <small>Valor recebido no banco</small>
            </div>
            <div class="stat-box alert">
                <h4><i class="fas fa-gavel"></i> IVA 23% DEVOLVER</h4>
                <p id="iva23Val" class="alert-text">0.00€</p>
                <small>Dívida ao Estado Português</small>
            </div>
        </section>

        <!-- Grid Principal -->
        <div class="main-grid">
            <!-- Zona de Upload -->
            <aside class="upload-zone">
                <!-- Control File -->
                <div class="upload-card" onclick="document.getElementById('controlFile').click()">
                    <div class="upload-icon">
                        <i class="fas fa-file-csv"></i>
                    </div>
                    <div class="upload-info">
                        <h4>FICHEIRO DE CONTROLO</h4>
                        <p>CSV com hashes de referência</p>
                        <small>Clique para selecionar</small>
                    </div>
                    <input type="file" id="controlFile" class="file-input" accept=".csv" hidden>
                </div>
                <div id="controlFileList" class="file-list"></div>

                <!-- SAF-T Files -->
                <div class="upload-card multi-upload" onclick="document.getElementById('saftFile').click()">
                    <div class="upload-icon">
                        <i class="fas fa-file-code"></i>
                    </div>
                    <div class="upload-info">
                        <h4>SAF-T / XML (MÚLTIPLOS)</h4>
                        <p>Ficheiros SAF-T do ano fiscal</p>
                        <small>Ctrl+Click para seleção múltipla</small>
                    </div>
                    <input type="file" id="saftFile" class="file-input" multiple accept=".xml,.csv" hidden>
                </div>
                <div id="saftFileList" class="file-list"></div>

                <!-- Platform Invoices -->
                <div class="upload-card multi-upload" onclick="document.getElementById('invoiceFile').click()">
                    <div class="upload-icon">
                        <i class="fas fa-receipt"></i>
                    </div>
                    <div class="upload-info">
                        <h4>FATURAS DA PLATAFORMA</h4>
                        <p>Faturas Uber/Bolt (PDF/CSV)</p>
                        <small>Base para autoliquidação IVA</small>
                    </div>
                    <input type="file" id="invoiceFile" class="file-input" multiple accept=".pdf,.csv,.xml" hidden>
                </div>
                <div id="invoiceFileList" class="file-list"></div>

                <!-- Bank Statements -->
                <div class="upload-card multi-upload" onclick="document.getElementById('statementFile').click()">
                    <div class="upload-icon">
                        <i class="fas fa-university"></i>
                    </div>
                    <div class="upload-info">
                        <h4>EXTRATOS BANCÁRIOS</h4>
                        <p>Extratos de conta (PDF/CSV)</p>
                        <small>Valor real transferido</small>
                    </div>
                    <input type="file" id="statementFile" class="file-input" multiple accept=".pdf,.csv,.txt" hidden>
                </div>
                <div id="statementFileList" class="file-list"></div>

                <!-- Legal Framework -->
                <div class="legal-box">
                    <h4><i class="fas fa-scale-balanced"></i> ENQUADRAMENTO LEGAL</h4>
                    <div class="legal-citations">
                        <p><strong>CIVA Art. 2º nº 1 i)</strong> - Inversão do sujeito passivo</p>
                        <p><strong>Código Penal Art. 376º</strong> - Fraude fiscal qualificada</p>
                        <p><strong>Estatuto Benefícios Fiscais</strong> - Omissão de autoliquidação</p>
                        <p class="warn-text"><i class="fas fa-exclamation-triangle"></i> Dívida ao Estado: IVA 23% sobre serviços intracomunitários</p>
                    </div>
                </div>
            </aside>

            <!-- Núcleo de Análise -->
            <section class="analysis-core">
                <!-- Gráfico Forense -->
                <div class="chart-wrapper">
                    <h4><i class="fas fa-chart-bar"></i> CRUZAMENTO FORENSE</h4>
                    <div class="chart-container">
                        <canvas id="forensicChart"></canvas>
                    </div>
                    <div class="chart-legend">
                        <span class="legend-item"><i class="fas fa-square" style="color: #00f2ff;"></i> Bruto SAF-T</span>
                        <span class="legend-item"><i class="fas fa-square" style="color: #ff3e3e;"></i> Comissão Plataforma</span>
                        <span class="legend-item"><i class="fas fa-square" style="color: #10b981;"></i> Transferência Real</span>
                        <span class="legend-item"><i class="fas fa-square" style="color: #f59e0b;"></i> IVA 23% Devido</span>
                    </div>
                </div>

                <!-- Resultados de Triangulação -->
                <div class="triangulation-results">
                    <h4><i class="fas fa-search"></i> TRIANGULAÇÃO FORENSE</h4>
                    <div class="triangulation-grid">
                        <div class="triang-card">
                            <h5>CRUZAMENTO A (ΔA)</h5>
                            <p class="formula">Bruto SAF-T - Comissão ⟺ Transferência</p>
                            <div class="result" id="deltaAResult">
                                <span class="value">0.00€</span>
                                <span class="status pending">Pendente</span>
                            </div>
                            <small>Discrepância: <span id="deltaADiff">0.00€</span></small>
                        </div>
                        <div class="triang-card">
                            <h5>CRUZAMENTO B (ΔB)</h5>
                            <p class="formula">Fatura Plataforma ⟺ Comissão Extrato</p>
                            <div class="result" id="deltaBResult">
                                <span class="value">0.00€</span>
                                <span class="status pending">Pendente</span>
                            </div>
                            <small>Discrepância: <span id="deltaBDiff">0.00€</span></small>
                        </div>
                        <div class="triang-card">
                            <h5>AUTOLIQUIDAÇÃO</h5>
                            <p class="formula">IVA 23% sobre Comissão</p>
                            <div class="result" id="autoliquidationResult">
                                <span class="value">0.00€</span>
                                <span class="status pending">Não calculado</span>
                            </div>
                            <small>Dívida fiscal ao Estado</small>
                        </div>
                        <div class="triang-card">
                            <h5>PROJEÇÃO MERCADO</h5>
                            <p class="formula">Média × 38.000 motoristas</p>
                            <div class="result" id="marketProjectionResult">
                                <span class="value">0.00M€</span>
                                <span class="status info">Base: esta amostra</span>
                            </div>
                            <small>Impacto económico potencial</small>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Console e Controles -->
        <footer class="main-footer">
            <!-- Console de Auditoria -->
            <div class="console-wrapper">
                <div class="console-header">
                    <h4><i class="fas fa-terminal"></i> CONSOLE DE AUDITORIA</h4>
                    <div class="console-controls">
                        <button class="icon-btn" onclick="clearConsole()" title="Limpar console">
                            <i class="fas fa-broom"></i>
                        </button>
                        <button class="icon-btn" onclick="toggleConsole()" title="Alternar tamanho">
                            <i class="fas fa-expand-alt"></i>
                        </button>
                    </div>
                </div>
                <div id="auditOutput" class="console-mini">
                    <!-- Logs serão inseridos aqui -->
                </div>
            </div>

            <!-- Barra de Ações -->
            <div class="action-bar">
                <button id="analyzeBtn" class="btn-main" onclick="performForensicAnalysis()" disabled>
                    <i class="fas fa-search"></i> EXECUTAR ANÁLISE FORENSE
                </button>
                <div class="secondary-actions">
                    <button class="btn-sub" onclick="exportJSON()">
                        <i class="fas fa-code"></i> PROVA DIGITAL (JSON)
                    </button>
                    <button class="btn-sub" onclick="exportPDF()">
                        <i class="fas fa-file-pdf"></i> RELATÓRIO PERICIAL (PDF)
                    </button>
                    <button class="btn-sub" onclick="clearSession()">
                        <i class="fas fa-redo"></i> NOVA SESSÃO
                    </button>
                </div>
            </div>

            <!-- Informação do Sistema -->
            <div class="system-info">
                <div class="master-hash">
                    <strong><i class="fas fa-fingerprint"></i> MASTER HASH DA SESSÃO:</strong>
                    <span id="masterHashValue">AGUARDANDO GERAÇÃO...</span>
                </div>
                <div class="copyright">
                    <i class="fas fa-shield-alt"></i> VDC Sistema de Peritagem Forense v6.0 | Big Data Forense | Conformidade CIVA Art. 2º | © 2024
                </div>
            </div>
        </footer>
    </div>

    <script src="script.js"></script>
</body>
</html>
