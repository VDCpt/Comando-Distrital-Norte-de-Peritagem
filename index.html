<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VDC FORENSE ¬∑ v12.9 CSI MIAMI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- BARREIRA DE ENTRADA (LOADING SCREEN) -->
    <div class="loading-screen" id="loading-screen">
        <div class="spinner"></div>
        <div class="loading-text">VDC FORENSE ¬∑ INICIALIZANDO M√ìDULOS DE AUDITORIA</div>
    </div>

    <!-- SISTEMA PRINCIPAL -->
    <div class="app-container" id="app-container" style="display: none;">
        <!-- HEADER -->
        <header class="main-header">
            <div class="brand">
                <div class="logo">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                        <path d="M2 17l10 5 10-5"/>
                        <path d="M2 12l10 5 10-5"/>
                    </svg>
                </div>
                <div class="brand-text">
                    <h1>VDC FORENSE <span class="version">v12.9</span></h1>
                    <p>ISO/IEC 27037 ¬∑ NIST SP 800-86 ¬∑ CSI MIAMI</p>
                </div>
            </div>
            <div class="session-info">
                <div class="badge simulated">CASO SIMULADO ¬∑ AUDITORIA DIGITAL</div>
                <div class="session-id">
                    <span>SESS√ÉO: <span id="session-id">CARREGANDO...</span></span>
                    <span id="session-time">--/--/---- | --:--:--</span>
                </div>
            </div>
        </header>

        <!-- MAIN LAYOUT -->
        <div class="main-layout">
            <!-- SIDEBAR -->
            <aside class="sidebar">
                <!-- PAINEL: IDENTIFICA√á√ÉO DO SUJEITO -->
                <section class="panel subject-panel">
                    <h3>IDENTIFICA√á√ÉO DO SUJEITO</h3>
                    <div class="form-group">
                        <label for="subject-name">NOME / EMPRESA</label>
                        <input type="text" id="subject-name" value="Momento Eficaz - Unip, Lda" placeholder="Nome ou Empresa">
                    </div>
                    <div class="form-group">
                        <label for="subject-nif">NIF</label>
                        <input type="text" id="subject-nif" value="517905450" placeholder="NIF" maxlength="9">
                    </div>
                    <button class="btn-validate" id="btn-validar" type="button">
                        <span class="icon">‚úì</span> VALIDAR
                    </button>
                    <div class="validation-status" id="validation-status">
                        <span class="status-dot"></span>
                        <span>Aguardando valida√ß√£o...</span>
                    </div>
                </section>

                <!-- PAINEL: PAR√ÇMETROS -->
                <section class="panel parameters-panel">
                    <h3>PAR√ÇMETROS DA PER√çCIA</h3>
                    <div class="form-group">
                        <label for="ano-fiscal">ANO FISCAL</label>
                        <select id="ano-fiscal">
                            <option value="2024" selected>2024</option>
                            <option value="2023">2023</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="periodo">PER√çODO PRINCIPAL</label>
                        <select id="periodo">
                            <option value="2" selected>2.¬∫ Semestre 2024</option>
                            <option value="1">1.¬∫ Semestre 2024</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="plataforma">PLATAFORMA</label>
                        <select id="plataforma">
                            <option value="bolt" selected>Bolt (Est√≥nia)</option>
                            <option value="uber">Uber (EUA)</option>
                        </select>
                    </div>
                </section>

                <!-- PAINEL: GEST√ÉO DE EVID√äNCIAS -->
                <section class="panel evidence-panel">
                    <h3>
                        <button class="btn-toggle-evidence" id="btn-toggle-evidence" type="button">
                            EVID√äNCIAS CARREGADAS
                            <span class="badge-count" id="total-evidencias">0</span>
                        </button>
                    </h3>
                    <div class="evidence-summary">
                        <div class="evidence-item" data-tipo="fat">
                            <span class="count" id="count-fat">0</span>
                            <span class="label">FATURAS</span>
                        </div>
                        <div class="evidence-item" data-tipo="ext">
                            <span class="count" id="count-ext">0</span>
                            <span class="label">EXTRATOS</span>
                        </div>
                        <div class="evidence-item" data-tipo="dac7">
                            <span class="count" id="count-dac7">0</span>
                            <span class="label">DAC7</span>
                        </div>
                        <div class="evidence-item" data-tipo="ctrl">
                            <span class="count" id="count-ctrl">0</span>
                            <span class="label">CTRL</span>
                        </div>
                        <div class="evidence-item" data-tipo="saft">
                            <span class="count" id="count-saft">0</span>
                            <span class="label">SAF-T</span>
                        </div>
                    </div>
                    <div class="values-indicator">
                        <span class="dot" id="values-dot"></span>
                        <span id="total-valores">0 valor(es)</span>
                    </div>
                </section>

                <!-- PAINEL: A√á√ïES PRINCIPAIS -->
                <section class="panel actions-panel">
                    <button class="btn-primary" id="btn-executar" type="button">
                        <span class="icon">üîç</span> EXECUTAR PER√çCIA
                    </button>
                    <button class="btn-secondary" id="btn-export-pdf" type="button">
                        <span class="icon">‚¨á</span> EXPORTAR RELAT√ìRIO PDF
                    </button>
                </section>
            </aside>

            <!-- CONTE√öDO PRINCIPAL -->
            <main class="content">
                <!-- TOOLBAR -->
                <div class="toolbar">
                    <button class="btn-tool" id="btn-export-json" type="button">
                        <span>{ }</span> EXPORTAR JSON
                    </button>
                    <button class="btn-tool" id="btn-reiniciar" type="button">
                        <span>‚Üª</span> REINICIAR AN√ÅLISE
                    </button>
                    <button class="btn-tool" id="btn-limpar" type="button">
                        <span>üóë</span> LIMPAR DADOS
                    </button>
                </div>

                <!-- ALERTAS DIN√ÇMICOS -->
                <div id="alertas-container" class="alertas-container"></div>

                <!-- M√âTRICAS PRINCIPAIS -->
                <section class="results-section">
                    <h3>M√âTRICAS FORENSES ¬∑ AGREGADAS</h3>
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <span class="label">GANHOS BRUTOS APP</span>
                            <span class="value positive" id="ganhos-app">0,00 ‚Ç¨</span>
                        </div>
                        <div class="metric-card">
                            <span class="label">COMISS√ïES BOLT</span>
                            <span class="value" id="comissoes-total">0,00 ‚Ç¨</span>
                        </div>
                        <div class="metric-card">
                            <span class="label">DAC7 (RECEITA ANUAL)</span>
                            <span class="value positive" id="dac7-anual">0,00 ‚Ç¨</span>
                        </div>
                        <div class="metric-card">
                            <span class="label">SAF-T (ESTIMADO)</span>
                            <span class="value" id="total-saft">0,00 ‚Ç¨</span>
                        </div>
                    </div>
                </section>

                <!-- PAIN√âIS DE DETALHE -->
                <div class="details-grid">
                    <!-- EXTRATO BOLT (DETALHADO) -->
                    <section class="detail-card">
                        <h4>EXTRATO BOLT ¬∑ MOVIMENTOS</h4>
                        <div class="detail-content">
                            <div class="detail-row">
                                <span>Ganhos na app</span>
                                <strong class="positive" id="ext-ganhos-app">0,00 ‚Ç¨</strong>
                            </div>
                            <div class="detail-row">
                                <span>Ganhos da campanha</span>
                                <strong class="positive" id="ext-ganhos-campanha">0,00 ‚Ç¨</strong>
                            </div>
                            <div class="detail-row">
                                <span>Gorjetas dos passageiros</span>
                                <strong class="positive" id="ext-gorjetas">0,00 ‚Ç¨</strong>
                            </div>
                            <div class="detail-row">
                                <span>Portagens</span>
                                <strong class="positive" id="ext-portagens">0,00 ‚Ç¨</strong>
                            </div>
                            <div class="detail-row negative">
                                <span>Taxas de cancelamento</span>
                                <strong id="ext-taxas-cancel">0,00 ‚Ç¨</strong>
                            </div>
                            <div class="detail-row negative">
                                <span>Comiss√£o da app</span>
                                <strong id="ext-comissoes">0,00 ‚Ç¨</strong>
                            </div>
                            <div class="detail-row total">
                                <span>Ganhos l√≠quidos (Transfer√™ncia)</span>
                                <strong class="positive" id="ext-ganhos-liquidos">0,00 ‚Ç¨</strong>
                            </div>
                        </div>
                    </section>

                    <!-- FATURA BOLT -->
                    <section class="detail-card">
                        <h4>FATURA BOLT ¬∑ COMISS√ïES</h4>
                        <div class="detail-content">
                            <div class="detail-row">
                                <span>N.¬∫ Fatura</span>
                                <strong id="fat-numero">---</strong>
                            </div>
                            <div class="detail-row">
                                <span>Total c/ IVA (EUR)</span>
                                <strong class="positive" id="fat-total">0,00 ‚Ç¨</strong>
                            </div>
                            <div class="detail-row autoliquidacao">
                                <span>Regime</span>
                                <strong>Autoliquida√ß√£o</strong>
                                <small>IVA 0%</small>
                            </div>
                            <div class="detail-row total">
                                <span>Per√≠odo faturado</span>
                                <strong id="fat-periodo">---</strong>
                            </div>
                        </div>
                    </section>

                    <!-- DAC7 REPORT -->
                    <section class="detail-card dac7-card">
                        <h4>DAC7 ¬∑ DECLARA√á√ÉO ANUAL</h4>
                        <div class="detail-content">
                            <div class="dac7-info">
                                <span class="dac7-label">RECEITA TOTAL</span>
                                <span class="dac7-value" id="dac7-valor">0,00 ‚Ç¨</span>
                            </div>
                            <div class="dac7-meta">
                                <span>Ano: <strong id="dac7-ano">2024</strong></span>
                                <span>Comiss√µes: <strong id="dac7-comissoes">0,00 ‚Ç¨</strong></span>
                                <span>Servi√ßos: <strong id="dac7-servicos">0</strong></span>
                            </div>
                            <div class="dac7-note" id="dac7-note">
                                Reporting nos termos do Art. 6.¬∫ DAC7
                            </div>
                        </div>
                    </section>
                </div>

                <!-- VEREDITO FISCAL (exibido ap√≥s per√≠cia) -->
                <section class="veredicto-section" id="veredicto-section" style="display: none;">
                    <div class="veredicto-header">
                        <h2>VEREDITO FISCAL ¬∑ TRIANGULA√á√ÉO</h2>
                        <div class="veredicto-status" id="veredicto-status">NORMAL</div>
                        <div class="veredicto-desvio" id="veredicto-desvio">Desvio: 0,00%</div>
                    </div>
                    <div class="anomalia-critica" id="anomalia-critica" style="display: none;">
                        <span class="icon-warning">‚ö†</span>
                        <div>
                            <strong>ANOMALIA CR√çTICA DETETADA</strong>
                            <p id="anomalia-texto">Potencial incumprimento fiscal (Art. 103.¬∫ RGIT)</p>
                            <span class="valor-anomalia" id="valor-anomalia">0,00 ‚Ç¨</span>
                        </div>
                    </div>
                    <div class="triangulacao-financeira">
                        <h4>TRIANGULA√á√ÉO FINANCEIRA</h4>
                        <div class="triangulacao-grid">
                            <div class="tri-item">
                                <span>BRUTO APP</span>
                                <strong id="tri-bruto">0,00 ‚Ç¨</strong>
                            </div>
                            <div class="tri-item">
                                <span>COMISS√ïES</span>
                                <strong id="tri-comissoes">0,00 ‚Ç¨</strong>
                            </div>
                            <div class="tri-item">
                                <span>L√çQUIDO EXT.</span>
                                <strong id="tri-liquido">0,00 ‚Ç¨</strong>
                            </div>
                            <div class="tri-item">
                                <span>FATURADO</span>
                                <strong id="tri-faturado">0,00 ‚Ç¨</strong>
                            </div>
                            <div class="tri-item discrepancia" id="tri-discrepancia-item" style="display: none;">
                                <span>DISCREP√ÇNCIA</span>
                                <strong id="tri-discrepancia">0,00 ‚Ç¨</strong>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- GR√ÅFICO COMPARATIVO -->
                <section class="chart-section">
                    <h4>AN√ÅLISE GR√ÅFICA ¬∑ COMPARATIVO</h4>
                    <div class="chart-container">
                        <canvas id="analiseGrafica"></canvas>
                        <div id="chart-fallback" class="chart-fallback" style="display: none;">
                            <p>Carregue evid√™ncias para gerar o gr√°fico</p>
                        </div>
                    </div>
                </section>

                <!-- LOG FORENSE -->
                <section class="log-section">
                    <h4>LOG FORENSE ¬∑ CADEIA DE CUST√ìDIA</h4>
                    <div class="log-container" id="log-container">
                        <div class="log-entry">
                            <span class="timestamp">[--:--:--]</span>
                            <span class="icon info">‚Ñπ</span>
                            <span class="message">Sistema VDC v12.9 inicializado. Anexe as evid√™ncias.</span>
                        </div>
                    </div>
                </section>

                <!-- HASH DA SESS√ÉO -->
                <section class="hash-section">
                    <div class="hash-display">
                        <span class="hash-label">HASH SHA-256 DA SESS√ÉO</span>
                        <span class="hash-value" id="hash-value">PENDENTE</span>
                    </div>
                    <div class="footer-info">
                        VDC Systems ¬© 2026 ¬∑ CSI MIAMI EDITION ¬∑ CADEIA DE CUST√ìDIA ATIVA
                    </div>
                </section>
            </main>
        </div>

        <!-- MODAL: GEST√ÉO DE EVID√äNCIAS (UPLOAD) -->
        <div class="modal-overlay" id="evidence-modal" style="display: none;">
            <div class="modal evidence-manager">
                <div class="modal-header">
                    <h3>GEST√ÉO DE EVID√äNCIAS ¬∑ UPLOAD</h3>
                    <button class="btn-close" id="btn-close-modal" type="button" aria-label="Fechar">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="evidence-stats">
                        <span>Ficheiros: <strong id="modal-total-files">0</strong></span>
                        <span>Valores detetados: <strong id="modal-total-values">0,00 ‚Ç¨</strong></span>
                    </div>

                    <!-- FATURAS BOLT -->
                    <div class="evidence-category">
                        <h4>FATURAS BOLT (PDF)</h4>
                        <div class="upload-zone" id="upload-faturas">
                            <span class="icon-upload">üìé</span>
                            <span>CLIQUE OU ARRASTE FATURAS AQUI</span>
                            <input type="file" id="input-faturas" multiple accept=".pdf,application/pdf">
                        </div>
                        <div class="file-list" id="lista-faturas"></div>
                        <div class="category-stats">
                            <span>Ficheiros: <strong id="stats-faturas-files">0</strong></span>
                            <span>Valor faturado: <strong id="stats-faturas-values">0,00 ‚Ç¨</strong></span>
                        </div>
                    </div>

                    <!-- EXTRATOS BOLT -->
                    <div class="evidence-category">
                        <h4>EXTRATOS BOLT (PDF)</h4>
                        <div class="upload-zone" id="upload-extratos">
                            <span class="icon-upload">üìÑ</span>
                            <span>CLIQUE OU ARRASTE EXTRATOS AQUI</span>
                            <input type="file" id="input-extratos" multiple accept=".pdf,application/pdf">
                        </div>
                        <div class="file-list" id="lista-extratos"></div>
                        <div class="category-stats">
                            <span>Ficheiros: <strong id="stats-extratos-files">0</strong></span>
                            <span>L√≠quido total: <strong id="stats-extratos-values">0,00 ‚Ç¨</strong></span>
                        </div>
                    </div>

                    <!-- DAC7 (PDF) -->
                    <div class="evidence-category">
                        <h4>DAC7 ¬∑ RELAT√ìRIO ANUAL (PDF)</h4>
                        <div class="upload-zone" id="upload-dac7">
                            <span class="icon-upload">üìä</span>
                            <span>CLIQUE OU ARRASTE RELAT√ìRIO DAC7</span>
                            <input type="file" id="input-dac7" multiple accept=".pdf,application/pdf">
                        </div>
                        <div class="file-list" id="lista-dac7"></div>
                        <div class="category-stats">
                            <span>Ficheiros: <strong id="stats-dac7-files">0</strong></span>
                            <span>Receita anual: <strong id="stats-dac7-values">0,00 ‚Ç¨</strong></span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-primary" id="btn-modal-fechar" type="button">FECHAR</button>
                    <button class="btn-danger" id="btn-modal-limpar" type="button">LIMPAR TUDO</button>
                </div>
            </div>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
