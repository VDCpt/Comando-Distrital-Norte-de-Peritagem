<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VDC | Unidade de Peritagem Forense - Sistema de Auditoria Fiscal v5.1</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- CSS Local -->
    <link rel="stylesheet" href="style.css">
    
    <!-- Estilos específicos para modal -->
    <style>
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            padding: 40px;
            border-radius: 20px;
            width: 90%;
            max-width: 700px;
            border: 3px solid #3b82f6;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
            color: #e2e8f0;
            text-align: center;
        }
        
        .modal-content h2 {
            color: #60a5fa;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }
        
        .modal-content p {
            margin-bottom: 15px;
            line-height: 1.6;
            font-size: 1.1rem;
        }
        
        .modal-btn {
            background: linear-gradient(90deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 30px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .modal-btn:hover {
            background: linear-gradient(90deg, #1d4ed8 0%, #1e40af 100%);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.4);
        }
        
        .modal-btn i {
            font-size: 1.3rem;
        }
    </style>
</head>
<body>
    <!-- Modal de Inicialização - TEXTO ATUALIZADO (Correção 3) -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-content">
            <h2><i class="fas fa-shield-alt"></i> PROTOCOLO DE SEGURANÇA E CUSTÓDIA DIGITAL V5.1</h2>
            <p><strong>SISTEMA DE PERITAGEM FORENSE VDC - TERMINAL OPERACIONAL</strong></p>
            <p>Este terminal opera sob <strong>Validação Seletiva de Integridade</strong>. Processamento ancorado em funções criptográficas SHA-256 com isolamento de metadados (Filtro de Ruído).</p>
            <p>A sessão gerará uma <strong>Assinatura Digital Única</strong> imutável, baseada exclusivamente em ficheiros validados contra registo externo de autenticidade.</p>
            <p style="color: #93c5fd; font-size: 1rem; margin-top: 25px; padding: 15px; background: rgba(30, 64, 175, 0.1); border-radius: 10px;">
                <i class="fas fa-exclamation-triangle"></i> ATENÇÃO: Ficheiro de controlo excluído de cálculos de hash (FILTRO DE RUÍDO ATIVO).
            </p>
            <button class="modal-btn" id="closeModalBtn">
                <i class="fas fa-key"></i> AUTORIZAR ACESSO E INICIAR PROTOCOLO
            </button>
        </div>
    </div>

    <div class="container">
        <!-- Cabeçalho -->
        <header>
            <div class="header-top">
                <h1><i class="fas fa-balance-scale"></i> SISTEMA DE PERITAGEM FORENSE VDC v5.1</h1>
                <div class="vdc-banner">
                    <p class="vdc">VALIDAÇÃO SELETIVA DE INTEGRIDADE</p>
                    <h2>ASSINATURA DIGITAL DA SESSÃO</h2>
                </div>
            </div>
            
            <!-- SECÇÃO DE CONFIGURAÇÃO (LAYOUT CORRIGIDO) -->
            <div class="config-section">
                <!-- Cliente -->
                <div class="config-group">
                    <h4><i class="fas fa-user-shield"></i> IDENTIFICAÇÃO DO CLIENTE</h4>
                    <div class="config-inputs">
                        <input type="text" id="clientName" placeholder="Nome Completo do Cliente" 
                               title="Digite para buscar clientes existentes">
                        <input type="text" id="clientNIF" placeholder="NIF (9 dígitos)"
                               title="Digite NIF para buscar cliente existente">
                        <button id="setClientBtn" class="config-btn">
                            <i class="fas fa-fingerprint"></i> REGISTAR CLIENTE
                        </button>
                    </div>
                </div>
                
                <!-- Ano -->
                <div class="config-group">
                    <h4><i class="fas fa-calendar-alt"></i> PERÍODO DE ANÁLISE</h4>
                    <select id="yearSelect" class="config-select" style="z-index: 10;">
                        <option value="2018">2018</option>
                        <option value="2019">2019</option>
                        <option value="2020">2020</option>
                        <option value="2021">2021</option>
                        <option value="2022">2022</option>
                        <option value="2023">2023</option>
                        <option value="2024">2024</option>
                        <option value="2025" selected>2025</option>
                        <option value="2026">2026</option>
                        <option value="2027">2027</option>
                        <option value="2028">2028</option>
                        <option value="2029">2029</option>
                        <option value="2030">2030</option>
                        <option value="2031">2031</option>
                        <option value="2032">2032</option>
                        <option value="2033">2033</option>
                        <option value="2034">2034</option>
                        <option value="2035">2035</option>
                        <option value="2036">2036</option>
                    </select>
                </div>
                
                <!-- Plataforma -->
                <div class="config-group">
                    <h4><i class="fas fa-mobile-alt"></i> PLATAFORMA DE ORIGEM</h4>
                    <select id="platformSelect" class="config-select">
                        <option value="bolt">Bolt (Estónia)</option>
                        <option value="uber">Uber (Holanda)</option>
                        <option value="outra">Outra Plataforma</option>
                    </select>
                </div>
                
                <!-- Status do Cliente -->
                <div id="clientStatus" class="status-message" style="display: none;">
                    <i class="fas fa-user-check"></i> CLIENTE REGISTADO: <span id="currentClient" style="font-weight: bold;">Aguardando...</span>
                    | EXERCÍCIO: <span id="currentYear" style="font-weight: bold;">2025</span>
                    | ORIGEM: <span id="currentPlatform" style="font-weight: bold;">Bolt (Estónia)</span>
                </div>
            </div>
        </header>

        <main>
            <!-- SECÇÃO DE CONTROLO DE AUTENTICIDADE (PRIORIDADE) -->
            <div class="control-section">
                <div class="control-header">
                    <div class="control-icon">
                        <i class="fas fa-key"></i>
                    </div>
                    <h3>
                        <i class="fas fa-database"></i> 1. REGISTO DE AUTENTICIDADE (.CSV) - PRIMEIRO PASSO
                    </h3>
                </div>
                
                <div class="control-card">
                    <div class="file-input-container">
                        <input type="file" id="controlFile" accept=".csv" class="file-input">
                        <label for="controlFile" class="file-label control-file-label">
                            <i class="fas fa-cloud-upload-alt"></i> CARREGAR FICHEIRO DE CONTROLO (.CSV)
                        </label>
                        <div class="file-info">
                            <i class="fas fa-info-circle"></i> Formato: "Algorithm","Hash","Path" - Ficheiro excluído de cálculos de hash (FILTRO DE RUÍDO)
                        </div>
                    </div>
                    <div id="controlStatus" class="status-message">
                        <i class="fas fa-clock"></i> AGUARDANDO FICHEIRO DE CONTROLO (PRIORIDADE)
                    </div>
                    
                    <!-- DASHBOARD DE VALIDAÇÃO SELETIVA -->
                    <div id="controlHashDashboard" class="hash-dashboard">
                        <h5>
                            <i class="fas fa-hashtag"></i> VALIDAÇÃO SELETIVA DOS FICHEIROS CARREGADOS
                        </h5>
                        <div class="data-grid dashboard-grid">
                            <div id="hash-saft-container" class="hash-container">
                                <div class="data-item">
                                    <span>Ficheiro SAF-T:</span> 
                                    <span id="hash-saft-status" class="hash-status">AGUARDANDO</span>
                                </div>
                                <div class="hash-value-ref" id="hash-saft-ref"></div>
                            </div>
                            
                            <div id="hash-fatura-container" class="hash-container">
                                <div class="data-item">
                                    <span>Ficheiro Fatura:</span> 
                                    <span id="hash-fatura-status" class="hash-status">AGUARDANDO</span>
                                </div>
                                <div class="hash-value-ref" id="hash-fatura-ref"></div>
                            </div>
                            
                            <div id="hash-extrato-container" class="hash-container">
                                <div class="data-item">
                                    <span>Ficheiro Extrato:</span> 
                                    <span id="hash-extrato-status" class="hash-status">AGUARDANDO</span>
                                </div>
                                <div class="hash-value-ref" id="hash-extrato-ref"></div>
                            </div>
                            
                            <!-- Mensagem quando nenhum ficheiro foi carregado -->
                            <div id="no-files-message" class="no-files-message">
                                <i class="fas fa-info-circle"></i> Nenhum ficheiro carregado no Passo 2
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Painel de Uploads de Documentos -->
            <div class="upload-section" id="documentUploadSection">
                <!-- 2. SAF-T -->
                <div class="upload-card">
                    <div class="card-header">
                        <span class="step-number">2</span>
                        <h4><i class="fas fa-file-csv"></i> FICHEIRO SAF-T (CSV)</h4>
                        <span class="validation-badge" id="saftValidationBadge"></span>
                    </div>
                    <div class="card-body">
                        <div class="file-input-container">
                            <input type="file" id="saftFile" accept=".csv" class="file-input" disabled>
                            <label for="saftFile" class="file-label disabled">
                                <i class="fas fa-cloud-upload-alt"></i> CARREGAR FICHEIRO SAF-T
                                <span class="lock-status">
                                    <i class="fas fa-lock"></i> AGUARDANDO CONTROLO
                                </span>
                            </label>
                        </div>
                        <div id="saftStatus" class="status-message">
                            <i class="fas fa-clock"></i> AGUARDANDO FICHEIRO DE CONTROLO...
                        </div>
                        <div id="saftHashStatus" class="hash-status-message">
                            <i class="fas fa-hashtag"></i> HASH CALCULADA: <span id="saftHashCalculada" class="hash-value-display">-</span>
                        </div>
                        <div id="saftValidationStatus" class="hash-status-message">
                            <i class="fas fa-hashtag"></i> HASH OFICIAL (CSV): <span id="saftHashOficial" class="hash-value-display official">-</span>
                        </div>
                        <div class="data-preview" id="saftPreview">
                            <h5><i class="fas fa-table"></i> METADADOS DO FICHEIRO SAF-T:</h5>
                            <div class="data-grid">
                                <div class="data-item"><span>Nome do Ficheiro:</span> <span id="saftFileName">-</span></div>
                                <div class="data-item"><span>Tamanho:</span> <span id="saftFileSize">-</span></div>
                                <div class="data-item"><span>Total de Registos:</span> <span id="saftRegistos">0</span></div>
                                <div class="data-item"><span>Ilíquido (Índice 14):</span> <span id="saftIliquido">0,00€</span></div>
                                <div class="data-item"><span>IVA 6% (Índice 13):</span> <span id="saftIVA">0,00€</span></div>
                                <div class="data-item"><span>Total (Índice 15):</span> <span id="saftBruto">0,00€</span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 3. Fatura Comissão -->
                <div class="upload-card">
                    <div class="card-header">
                        <span class="step-number">3</span>
                        <h4><i class="fas fa-file-invoice-euro"></i> FATURA DE COMISSÃO</h4>
                        <span class="validation-badge" id="invoiceValidationBadge"></span>
                    </div>
                    <div class="card-body">
                        <div class="file-input-container">
                            <input type="file" id="invoiceFile" accept=".pdf,.txt" class="file-input" disabled>
                            <label for="invoiceFile" class="file-label disabled">
                                <i class="fas fa-cloud-upload-alt"></i> CARREGAR FATURA (PDF ou TXT)
                                <span class="lock-status">
                                    <i class="fas fa-lock"></i> AGUARDANDO CONTROLO
                                </span>
                            </label>
                            <div class="file-info">
                                <i class="fas fa-info-circle"></i> Para PDFs, extraia o texto primeiro ou use ficheiro TXT
                            </div>
                        </div>
                        <div id="invoiceStatus" class="status-message">
                            <i class="fas fa-clock"></i> AGUARDANDO FICHEIRO DE CONTROLO...
                        </div>
                        <div id="invoiceHashStatus" class="hash-status-message">
                            <i class="fas fa-hashtag"></i> HASH CALCULADA: <span id="invoiceHashCalculada" class="hash-value-display">-</span>
                        </div>
                        <div id="invoiceValidationStatus" class="hash-status-message">
                            <i class="fas fa-hashtag"></i> HASH OFICIAL (CSV): <span id="invoiceHashOficial" class="hash-value-display official">-</span>
                        </div>
                        <div class="data-preview" id="invoicePreview">
                            <h5><i class="fas fa-receipt"></i> METADADOS DA FATURA:</h5>
                            <div class="data-grid">
                                <div class="data-item"><span>Nome do Ficheiro:</span> <span id="invoiceFileName">-</span></div>
                                <div class="data-item"><span>Tamanho:</span> <span id="invoiceFileSize">-</span></div>
                                <div class="data-item"><span>Referência Fatura:</span> <span id="invoiceReference">-</span></div>
                                <div class="data-item"><span>Total Faturado (EUR):</span> <span id="invoiceTotal">0,00€</span></div>
                                <div class="data-item"><span>IVA Estimado (23%):</span> <span id="invoiceIVA">0,00€</span></div>
                                <div class="data-item"><span>Regime de Autoliquidação:</span> <span id="invoiceRegime">Não identificado</span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 4. Extrato/Transferências -->
                <div class="upload-card">
                    <div class="card-header">
                        <span class="step-number">4</span>
                        <h4><i class="fas fa-file-invoice-dollar"></i> EXTRATO BANCÁRIO</h4>
                        <span class="validation-badge" id="statementValidationBadge"></span>
                    </div>
                    <div class="card-body">
                        <div class="file-input-container">
                            <input type="file" id="statementFile" accept=".pdf,.jpg,.jpeg,.png,.csv,.txt" class="file-input" disabled>
                            <label for="statementFile" class="file-label disabled">
                                <i class="fas fa-cloud-upload-alt"></i> CARREGAR EXTRATO
                                <span class="lock-status">
                                    <i class="fas fa-lock"></i> AGUARDANDO CONTROLO
                                </span>
                            </label>
                        </div>
                        <div id="statementStatus" class="status-message">
                            <i class="fas fa-clock"></i> AGUARDANDO FICHEIRO DE CONTROLO...
                        </div>
                        <div id="statementHashStatus" class="hash-status-message">
                            <i class="fas fa-hashtag"></i> HASH CALCULADA: <span id="statementHashCalculada" class="hash-value-display">-</span>
                        </div>
                        <div id="statementValidationStatus" class="hash-status-message">
                            <i class="fas fa-hashtag"></i> HASH OFICIAL (CSV): <span id="statementHashOficial" class="hash-value-display official">-</span>
                        </div>
                        <div class="data-preview" id="statementPreview">
                            <h5><i class="fas fa-bank"></i> METADADOS DO EXTRATO:</h5>
                            <div class="data-grid">
                                <div class="data-item"><span>Nome do Ficheiro:</span> <span id="statementFileName">-</span></div>
                                <div class="data-item"><span>Tamanho:</span> <span id="statementFileSize">-</span></div>
                                <div class="data-item"><span>Total Recebido:</span> <span id="totalRecebido">0,00€</span></div>
                                <div class="data-item"><span>Comissão da App (Real):</span> <span id="comissaoReal">0,00€</span></div>
                                <div class="data-item"><span>Ganhos Campanha:</span> <span id="ganhosCampanha">0,00€</span></div>
                                <div class="data-item"><span>Gorjetas:</span> <span id="gorjetas">0,00€</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Botão de Análise -->
            <div class="analyze-section">
                <button id="analyzeBtn" class="analyze-btn" disabled>
                    <i class="fas fa-search"></i> EXECUTAR ANÁLISE FORENSE
                </button>
                <div class="progress-container" id="progressContainer">
                    <div class="progress-bar" id="progressBar"></div>
                    <span class="progress-text" id="progressText">0%</span>
                </div>
            </div>

            <!-- Tabela de Análise Comparativa -->
            <div class="analysis-section" id="analysisSection">
                <h3><i class="fas fa-chart-line"></i> ANÁLISE COMPARATIVA FORENSE - <span id="analysisClient">CLIENTE</span></h3>
                <table class="analysis-table">
                    <thead>
                        <tr>
                            <th>DOCUMENTO/ORIGEM</th>
                            <th>COMISSÃO REAL (EXTRATO)</th>
                            <th>COMISSÃO FATURADA</th>
                            <th>DIVERGÊNCIA DETETADA</th>
                            <th>STATUS PERICIAL</th>
                        </tr>
                    </thead>
                    <tbody id="analysisTableBody"></tbody>
                </table>
            </div>

            <!-- Cálculo Tributário -->
            <div class="tax-section" id="taxSection">
                <h3><i class="fas fa-calculator"></i> CÁLCULO TRIBUTÁRIO PERICIAL - <span id="taxClient">CLIENTE</span></h3>
                
                <!-- SMOKING GUN - PROVA RAINHA -->
                <div class="smoking-gun">
                    <h4>
                        <i class="fas fa-exclamation-triangle"></i> PROVA RAINHA (SMOKING GUN) - DIVERGÊNCIA CRÍTICA
                    </h4>
                    <div class="data-grid smoking-grid">
                        <div class="data-item smoking-item real">
                            <span>Comissão Retida (Extrato):</span> <span id="comissaoExtrato">239,86€</span>
                        </div>
                        <div class="data-item smoking-item faturado">
                            <span>Comissão Faturada (Bolt):</span> <span id="comissaoFaturada">69,47€</span>
                        </div>
                        <div class="data-item smoking-item divergencia">
                            <span>DIVERGÊNCIA DE BASE (OMISSÃO):</span> <span id="divergenciaBase">170,39€ (71%)</span>
                        </div>
                        <div class="data-item smoking-item iva">
                            <span>IVA EM FALTA (23% sobre divergência):</span> <span id="ivaFalta">39,19€</span>
                        </div>
                    </div>
                </div>
                
                <div class="tax-grid">
                    <div class="tax-card">
                        <h4>IVA EM FALTA (23%):</h4>
                        <div class="tax-value" id="ivaValue">€0,00</div>
                        <small>Artigo 2.º, n.º 1, alínea i) CIVA</small>
                    </div>
                    <div class="tax-card">
                        <h4>DIVERGÊNCIA COMISSÃO</h4>
                        <div class="status-badge" id="divergenceStatus">AGUARDANDO</div>
                        <small>Matriz de Divergência</small>
                    </div>
                    <div class="tax-card">
                        <h4>IMPACTO IRC (22.5%):</h4>
                        <div class="risk-level critical" id="impactoIRC">€0,00</div>
                        <small>IRC + Derrama sobre divergência</small>
                    </div>
                    <div class="tax-card">
                        <h4>ASSINATURA DIGITAL DA SESSÃO</h4>
                        <div class="hash-value" id="hashValue">AGUARDANDO CARREGAMENTO DE FICHEIROS</div>
                        <small>Master Hash SHA-256 (baseada em ficheiros válidos)</small>
                    </div>
                </div>
                
                <!-- Gráficos -->
                <div class="charts-container">
                    <div class="chart-box">
                        <h4><i class="fas fa-chart-bar"></i> DISCREPÂNCIA DE COMISSÃO</h4>
                        <canvas id="comissaoChart"></canvas>
                    </div>
                    <div class="chart-box">
                        <h4><i class="fas fa-chart-pie"></i> DISTRIBUIÇÃO DE IMPACTOS FISCAIS</h4>
                        <canvas id="ivaChart"></canvas>
                    </div>
                </div>
                
                <!-- PARECER TÉCNICO FORENSE DINÂMICO -->
                <div class="technical-details" id="parecerTecnico">
                    <h4>
                        <i class="fas fa-gavel"></i> PARECER TÉCNICO FORENSE DINÂMICO
                    </h4>
                    <div class="parecer-content">
                        <h5>PARECER TÉCNICO N.º VDC-PF/2026/001</h5>
                        
                        <div class="parecer-section">
                            <h6>I. ANÁLISE PERICIAL:</h6>
                            <p id="parecerAnalise">Discrepância grave detetada entre valores retidos pela Bolt e valores faturados.</p>
                        </div>
                        
                        <div class="parecer-section">
                            <h6>II. FATOS CONSTATADOS:</h6>
                            <ol>
                                <li>Comissão Real Retida (Extrato): <span id="parecerComissaoReal">239,86€</span>.</li>
                                <li>Valor Faturado (Fatura): <span id="parecerComissaoFaturada">69,47€</span>.</li>
                                <li>Diferença Omitida: <span id="parecerDivergencia">170,39€</span> <span id="parecerPercentagem">(71.04% do valor retido)</span>.</li>
                            </ol>
                        </div>
                        
                        <div class="parecer-section">
                            <h6>III. ENQUADRAMENTO LEGAL:</h6>
                            <p id="parecerLegal">Violação do Artigo 2.º, n.º 1, alínea i) do CIVA (Autoliquidação) e indícios de infração ao Artigo 108.º do CIVA.</p>
                        </div>
                        
                        <div class="parecer-section">
                            <h6>IV. IMPACTO FISCAL E PROJEÇÃO SISTÉMICA:</h6>
                            <ul>
                                <li>IVA em falta (23%): <span id="parecerIVA">39,19€</span> omitidos ao erário público.</li>
                                <li>Impacto IRC/Derrama (22.5%): <span id="parecerImpactoIRC">38,34€</span> sobre divergência.</li>
                                <li>Impacto Mensal Global (extrapolação 38.000 motoristas): <span id="parecerImpactoMensalGlobal">6.474.820,00€</span>.</li>
                                <li>Impacto Anual Global (×12 meses): <span id="parecerImpactoAnualGlobal">77.697.840,00€</span>.</li>
                                <li>Projeção a 7 anos (38.000 motoristas × 12 meses × 7 anos): <span id="parecerImpacto7AnosValor">543.884.880,00€</span>.</li>
                            </ul>
                        </div>
                        
                        <div class="parecer-section">
                            <h6>V. AUTENTICIDADE E VALIDAÇÃO SELETIVA:</h6>
                            <p id="parecerAutenticidade">Aguardando validação seletiva dos ficheiros carregados.</p>
                            <p class="master-hash-display" id="parecerMasterHash">AGUARDANDO GERAÇÃO DE ASSINATURA DIGITAL...</p>
                        </div>
                        
                        <div class="parecer-section">
                            <h6>VI. CONCLUSÃO ESTRATÉGICA:</h6>
                            <p class="conclusao">A materialidade da omissão (71.04%) configura um risco sistémico. Este relatório serve de suporte técnico para procedimentos de regularização voluntária ou interpelação judicial por quebra de conformidade fiscal da entidade emissora.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Detalhes Técnicos -->
                <div class="technical-details">
                    <h4>
                        <i class="fas fa-microscope"></i> DETALHES TÉCNICOS DA ANÁLISE
                    </h4>
                    <div class="data-grid tech-grid">
                        <div class="data-item"><span>Ficheiro SAF-T:</span> <span id="detSaftFile">-</span></div>
                        <div class="data-item"><span>Ficheiro Fatura:</span> <span id="detInvoiceFile">-</span></div>
                        <div class="data-item"><span>Ficheiro Extrato:</span> <span id="detStatementFile">-</span></div>
                        <div class="data-item"><span>Referência Fatura:</span> <span id="detInvoiceRef">-</span></div>
                        <div class="data-item"><span>Regime Autoliquidação:</span> <span id="detAutoliquidação">-</span></div>
                        <div class="data-item"><span>Timestamp Análise:</span> <span id="detTimestamp">-</span></div>
                    </div>
                </div>
            </div>

            <!-- Botões de Ação -->
            <div class="action-buttons" id="actionButtons">
                <button id="generateReportBtn" class="action-btn report-btn" disabled>
                    <i class="fas fa-file-pdf"></i> GERAR E SELAR RELATÓRIO PDF
                </button>
                <button id="saveReportBtn" class="action-btn save-btn" disabled>
                    <i class="fas fa-save"></i> GUARDAR ANÁLISE COMPLETA
                </button>
            </div>

            <!-- Metodologia e Fundamentos -->
            <div class="methodology-section">
                <div class="methodology-card">
                    <h4><i class="fas fa-gavel"></i> ENQUADRAMENTO LEGAL</h4>
                    <p><strong>Artigo 2.º, n.º 1, alínea i) do Código do IVA:</strong> Regime de autoliquidação aplicável a serviços prestados por sujeitos passivos não residentes em território português.</p>
                    <ul>
                        <li><strong>IVA Omitido:</strong> 23% sobre comissão real vs faturada</li>
                        <li><strong>Base Tributável:</strong> Diferença detetada na matriz</li>
                        <li><strong>Prazo Regularização:</strong> 30 dias após deteção</li>
                        <li><strong>Sanções Aplicáveis:</strong> Artigo 108.º do CIVA</li>
                    </ul>
                </div>

                <div class="methodology-card">
                    <h4><i class="fas fa-balance-scale"></i> METODOLOGIA PERICIAL</h4>
                    <p><strong>BTOR (Bank Transactions Over Reality):</strong> Análise comparativa entre movimentos bancários reais e documentação fiscal declarada.</p>
                    <ul>
                        <li>Mapeamento posicional de dados SAF-T</li>
                        <li>Extração precisa de valores de extrato</li>
                        <li>Cálculo de divergência automático</li>
                        <li>Geração de prova técnica auditável</li>
                    </ul>
                </div>

                <div class="methodology-card">
                    <h4><i class="fas fa-shield-alt"></i> VALIDAÇÃO SELETIVA DE INTEGRIDADE</h4>
                    <p>Sistema de validação seletiva: a Master Hash é calculada apenas sobre os ficheiros carregados que obtiveram correspondência no controlo. Filtro de ruído ativo.</p>
                    <div class="data-grid methodology-grid">
                        <div class="data-item"><span>Algoritmo Hash:</span> <span class="hash-algo">SHA-256</span></div>
                        <div class="data-item"><span>Validação:</span> <span class="validation-type">Seletiva (por ficheiro)</span></div>
                        <div class="data-item"><span>Filtro de Ruído:</span> <span class="noise-filter">Ativo</span></div>
                        <div class="data-item"><span>Assinatura:</span> <span class="signature-type">Digital da Sessão</span></div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer>
            <div class="footer-content">
                <p><i class="fas fa-shield-alt"></i> <strong>VDC - UNIDADE DE PERITAGEM FORENSE v5.1</strong> | SISTEMA DE VALIDAÇÃO SELETIVA</p>
                <p class="timestamp"><i class="fas fa-database"></i> FILTRO DE RUÍDO ATIVO: FICHEIRO DE CONTROLO EXCLUÍDO DE CÁLCULOS DE HASH</p>
                <p class="timestamp"><i class="fas fa-clock"></i> TIMESTAMP: <span id="currentTimestamp">carregando...</span></p>
                <p class="timestamp">
                    <i class="fas fa-hashtag"></i> ASSINATURA DIGITAL DA SESSÃO: 
                    <br>
                    <span id="currentMasterHash" class="master-hash-footer">
                        AGUARDANDO FICHEIROS VÁLIDOS...
                    </span>
                </p>
                <p class="copyright">
                    © 2024-2026 VDC - VOZ DO CONDUTOR | PERITAGEM FISCAL COM VALIDAÇÃO SELETIVA
                </p>
            </div>
        </footer>
    </div>

    <!-- Scripts externos -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Script Local -->
    <script src="script.js"></script>
</body>
</html>
