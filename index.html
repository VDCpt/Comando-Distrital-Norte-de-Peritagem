<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VDC FORENSE - v12.8 CSI MIAMI</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-parse/1.1.1/pdf-parse.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="main-header">
            <div class="brand">
                <div class="logo">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                    </svg>
                </div>
                <div class="brand-text">
                    <h1>VDC FORENSE <span class="version">v12.8</span></h1>
                    <p>ISO/IEC 27037 | NIST SP 800-86 | Interpol Digital Forensics</p>
                </div>
            </div>
            <div class="session-info">
                <div class="badge simulated">CASO SIMULADO</div>
                <div class="session-id">
                    SESSÃO: <span id="session-id">VDC-NLP301ZV-3THU6</span>
                    <span id="session-time">16/02/2026 | 11:51:55</span>
                </div>
            </div>
        </header>

        <div class="main-layout">
            <!-- Sidebar -->
            <aside class="sidebar">
                <!-- Identificação do Sujeito -->
                <section class="panel subject-panel">
                    <h3><i class="icon-user"></i> IDENTIFICAÇÃO DO SUJEITO</h3>
                    <div class="form-group">
                        <label>NOME / EMPRESA</label>
                        <input type="text" id="subject-name" value="Momento Lda" placeholder="Nome ou Empresa">
                    </div>
                    <div class="form-group">
                        <label>NIF</label>
                        <input type="text" id="subject-nif" value="123456789" placeholder="Número de Identificação Fiscal">
                    </div>
                    <button class="btn-validate" onclick="validarSujeito()">
                        <i class="icon-check"></i> VALIDAR
                    </button>
                    <div class="validation-status" id="validation-status">
                        <span class="status-dot valid"></span>
                        <span>Momento Lda | 123456789</span>
                    </div>
                </section>

                <!-- Parâmetros -->
                <section class="panel parameters-panel">
                    <h3><i class="icon-settings"></i> PARÂMETROS</h3>
                    <div class="form-group">
                        <label>ANO FISCAL</label>
                        <select id="ano-fiscal" onchange="atualizarPeriodo()">
                            <option value="2024" selected>2024</option>
                            <option value="2023">2023</option>
                            <option value="2022">2022</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>PERÍODO</label>
                        <select id="periodo">
                            <option value="1">1.º Semestre</option>
                            <option value="2" selected>2.º Semestre</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>PLATAFORMA</label>
                        <select id="plataforma" onchange="mudarPlataforma()">
                            <option value="bolt" selected>Bolt (Estónia)</option>
                            <option value="uber">Uber (EUA)</option>
                            <option value="free">Free Now (Alemanha)</option>
                        </select>
                    </div>
                </section>

                <!-- Gestão de Evidências -->
                <section class="panel evidence-panel">
                    <h3 onclick="toggleEvidenceManager()">
                        <i class="icon-folder"></i> GESTÃO DE EVIDÊNCIAS
                        <span class="badge-count" id="total-evidencias">15</span>
                    </h3>
                    <div class="evidence-summary">
                        <div class="evidence-item" onclick="abrirGestaoEvidencias('ctrl')">
                            <span class="count" id="count-ctrl">4</span>
                            <span class="label">CTRL</span>
                        </div>
                        <div class="evidence-item" onclick="abrirGestaoEvidencias('saft')">
                            <span class="count" id="count-saft">4</span>
                            <span class="label">SAF-T</span>
                        </div>
                        <div class="evidence-item" onclick="abrirGestaoEvidencias('fat')">
                            <span class="count" id="count-fat">2</span>
                            <span class="label">FAT</span>
                        </div>
                        <div class="evidence-item" onclick="abrirGestaoEvidencias('ext')">
                            <span class="count" id="count-ext">4</span>
                            <span class="label">EXT</span>
                        </div>
                        <div class="evidence-item" onclick="abrirGestaoEvidencias('dac7')">
                            <span class="count" id="count-dac7">1</span>
                            <span class="label">DAC7</span>
                        </div>
                    </div>
                    <div class="values-indicator">
                        <span class="dot active"></span>
                        <span id="total-valores">10 valor(es)</span>
                    </div>
                </section>

                <!-- Ações -->
                <section class="panel actions-panel">
                    <button class="btn-primary" onclick="executarPericia()">
                        <i class="icon-search"></i> EXECUTAR PERÍCIA
                    </button>
                    <button class="btn-secondary" onclick="exportarPDF()">
                        <i class="icon-download"></i> EXPORTAR PDF
                    </button>
                </section>
            </aside>

            <!-- Main Content -->
            <main class="content">
                <!-- Toolbar -->
                <div class="toolbar">
                    <button class="btn-tool" onclick="exportarJSON()">
                        <i class="icon-json"></i> EXPORTAR JSON
                    </button>
                    <button class="btn-tool" onclick="reiniciarAnalise()">
                        <i class="icon-refresh"></i> REINICIAR
                    </button>
                    <button class="btn-tool" onclick="limparDados()">
                        <i class="icon-trash"></i> LIMPAR
                    </button>
                </div>

                <!-- Alertas de Validação -->
                <div id="alertas-container" class="alertas-container"></div>

                <!-- Resultados Forenses -->
                <section class="results-section">
                    <h3><i class="icon-chart"></i> RESULTADOS FORENSES</h3>
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <span class="label">GANHOS APP</span>
                            <span class="value positive" id="ganhos-app">0,00 €</span>
                        </div>
                        <div class="metric-card">
                            <span class="label">COMISSÕES</span>
                            <span class="value" id="comissoes-total">0,00 €</span>
                        </div>
                        <div class="metric-card">
                            <span class="label">DAC7 ANUAL</span>
                            <span class="value" id="dac7-anual">0,00 €</span>
                        </div>
                        <div class="metric-card">
                            <span class="label">TOTAL SAF-T</span>
                            <span class="value positive" id="total-saft">0,00 €</span>
                        </div>
                    </div>
                </section>

                <!-- Detalhamento -->
                <div class="details-grid">
                    <!-- SAF-T -->
                    <section class="detail-card">
                        <h4><i class="icon-file"></i> SAF-T (PT)</h4>
                        <div class="detail-content">
                            <div class="detail-row">
                                <span>VALOR LÍQUIDO</span>
                                <strong id="saft-liquido">0,00 €</strong>
                            </div>
                            <div class="detail-row autoliquidacao">
                                <span>IVA</span>
                                <strong id="saft-iva">---</strong>
                                <small>Autoliquidação</small>
                            </div>
                            <div class="detail-row total">
                                <span>TOTAL SAF-T</span>
                                <strong id="saft-total">0,00 €</strong>
                            </div>
                        </div>
                    </section>

                    <!-- Extratos Bolt -->
                    <section class="detail-card">
                        <h4><i class="icon-file-alt"></i> EXTRATOS BOLT</h4>
                        <div class="detail-content">
                            <div class="detail-row">
                                <span>GANHOS NA APP</span>
                                <strong class="positive" id="ext-ganhos-app">0,00 €</strong>
                            </div>
                            <div class="detail-row">
                                <span>GANHOS CAMPANHA</span>
                                <strong id="ext-ganhos-campanha">0,00 €</strong>
                            </div>
                            <div class="detail-row">
                                <span>GORJETAS</span>
                                <strong id="ext-gorjetas">0,00 €</strong>
                            </div>
                            <div class="detail-row">
                                <span>PORTAGENS</span>
                                <strong id="ext-portagens">0,00 €</strong>
                            </div>
                            <div class="detail-row negative">
                                <span>TAXAS CANCEL.</span>
                                <strong id="ext-taxas-cancel">0,00 €</strong>
                            </div>
                            <div class="detail-row">
                                <span>COMISSÕES</span>
                                <strong id="ext-comissoes">0,00 €</strong>
                            </div>
                            <div class="detail-row total">
                                <span>GANHOS LÍQUIDOS</span>
                                <strong class="positive" id="ext-ganhos-liquidos">0,00 €</strong>
                            </div>
                        </div>
                    </section>

                    <!-- DAC7 -->
                    <section class="detail-card dac7-card">
                        <h4><i class="icon-globe"></i> DAC7</h4>
                        <div class="detail-content">
                            <div class="dac7-info">
                                <span class="dac7-label">REPORTING ANUAL</span>
                                <span class="dac7-value" id="dac7-valor">0,00 €</span>
                            </div>
                            <div class="dac7-meta">
                                <span>Ano: <strong id="dac7-ano">2024</strong></span>
                                <span>Data limite: <strong id="dac7-limite">31/01/2025</strong></span>
                            </div>
                            <div class="dac7-note">
                                Valor reportado pela Bolt às autoridades fiscais (Art. 6º DAC7)
                            </div>
                        </div>
                    </section>
                </div>

                <!-- Faturas Bolt -->
                <section class="invoices-section">
                    <h4><i class="icon-invoice"></i> FATURAS BOLT</h4>
                    <div class="invoice-grid">
                        <div class="invoice-item">
                            <span class="label">N.º FATURA</span>
                            <strong id="fat-numero">PT1124</strong>
                        </div>
                        <div class="invoice-item">
                            <span class="label">TOTAL C/ IVA</span>
                            <strong class="positive" id="fat-total">0,00 €</strong>
                        </div>
                        <div class="invoice-item autoliquidacao">
                            <span class="label">AUTOLIQUIDAÇÃO</span>
                            <strong id="fat-autoliquidacao">0,00 €</strong>
                            <small>IVA - Autoliquidação</small>
                        </div>
                    </div>
                </section>

                <!-- Veredicto Fiscal -->
                <section class="veredicto-section" id="veredicto-section" style="display: none;">
                    <div class="veredicto-header" id="veredicto-header">
                        <h2>VEREDICTO FISCAL</h2>
                        <div class="veredicto-status" id="veredicto-status">NORMAL</div>
                        <div class="veredicto-desvio" id="veredicto-desvio">Desvio: 0%</div>
                    </div>
                    <div class="anomalia-critica" id="anomalia-critica" style="display: none;">
                        <i class="icon-warning"></i>
                        <div>
                            <strong>ANOMALIA CRÍTICA</strong>
                            <p id="anomalia-texto">Indício de fraude fiscal</p>
                            <span class="valor-anomalia" id="valor-anomalia">0,00 €</span>
                        </div>
                    </div>
                    <div class="triangulacao-financeira">
                        <h4>TRIANGULAÇÃO FINANCEIRA</h4>
                        <div class="triangulacao-grid">
                            <div class="tri-item">
                                <span>BRUTO APP</span>
                                <strong id="tri-bruto">0,00 €</strong>
                            </div>
                            <div class="tri-item">
                                <span>COMISSÕES</span>
                                <strong id="tri-comissoes">0,00 €</strong>
                            </div>
                            <div class="tri-item">
                                <span>LÍQUIDO</span>
                                <strong id="tri-liquido">0,00 €</strong>
                            </div>
                            <div class="tri-item" id="tri-faturado-item">
                                <span>FATURADO</span>
                                <strong id="tri-faturado">0,00 €</strong>
                            </div>
                            <div class="tri-item discrepancia" id="tri-discrepancia-item" style="display: none;">
                                <span>DISCREPÂNCIA</span>
                                <strong id="tri-discrepancia">0,00 €</strong>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Análise Gráfica -->
                <section class="chart-section">
                    <h4><i class="icon-chart-bar"></i> ANÁLISE GRÁFICA</h4>
                    <div class="chart-container">
                        <canvas id="analiseGrafica"></canvas>
                    </div>
                </section>

                <!-- Log Forense -->
                <section class="log-section">
                    <h4><i class="icon-terminal"></i> LOG FORENSE</h4>
                    <div class="log-container" id="log-container">
                        <div class="log-entry">
                            <span class="timestamp">[11:44:24]</span>
                            <span class="icon success">✓</span>
                            <span class="message">Fatura processada: PT1124-91599.pdf</span>
                        </div>
                    </div>
                </section>

                <!-- Hash SHA-256 -->
                <section class="hash-section">
                    <div class="hash-display">
                        <span class="hash-label">HASH SHA-256</span>
                        <span class="hash-value" id="hash-value">343fcd94aa5a4c6e28accb48a754f4187d829ea54f7285e1574e6af312a5d3e2</span>
                    </div>
                    <div class="footer-info">
                        VDC Systems © 2024/2026 | CSI MIAMI EDITION
                    </div>
                </section>
            </main>
        </div>

        <!-- Modal Gestão de Evidências -->
        <div class="modal-overlay" id="evidence-modal" style="display: none;">
            <div class="modal evidence-manager">
                <div class="modal-header">
                    <h3><i class="icon-folder-open"></i> GESTÃO DE EVIDÊNCIAS</h3>
                    <button class="btn-close" onclick="fecharGestaoEvidencias()">×</button>
                </div>
                <div class="modal-body">
                    <div class="evidence-stats">
                        <span>Ficheiros: <strong id="modal-total-files">0</strong></span>
                        <span>Valores: <strong id="modal-total-values">0</strong></span>
                    </div>
                    
                    <!-- Faturas Bolt -->
                    <div class="evidence-category">
                        <h4><i class="icon-file-pdf"></i> FATURAS BOLT (PDF)</h4>
                        <div class="upload-zone" onclick="document.getElementById('input-faturas').click()">
                            <i class="icon-upload"></i>
                            <span>SELECIONAR</span>
                            <input type="file" id="input-faturas" multiple accept=".pdf" onchange="processarFaturas(this.files)" style="display: none;">
                        </div>
                        <div class="file-list" id="lista-faturas">
                            <!-- Preenchido dinamicamente -->
                        </div>
                        <div class="category-stats">
                            <span>Ficheiros: <strong id="stats-faturas-files">0</strong></span>
                            <span>Valores: <strong id="stats-faturas-values">0</strong></span>
                        </div>
                    </div>

                    <!-- Extratos Bolt -->
                    <div class="evidence-category">
                        <h4><i class="icon-file-pdf"></i> EXTRATOS BOLT (PDF)</h4>
                        <div class="upload-zone" onclick="document.getElementById('input-extratos').click()">
                            <i class="icon-upload"></i>
                            <span>SELECIONAR</span>
                            <input type="file" id="input-extratos" multiple accept=".pdf" onchange="processarExtratos(this.files)" style="display: none;">
                        </div>
                        <div class="file-list" id="lista-extratos">
                            <!-- Preenchido dinamicamente -->
                        </div>
                        <div class="category-stats">
                            <span>Ficheiros: <strong id="stats-extratos-files">0</strong></span>
                            <span>Valores: <strong id="stats-extratos-values">0</strong></span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-primary" onclick="fecharGestaoEvidencias()">
                        <i class="icon-check"></i> FECHAR
                    </button>
                    <button class="btn-danger" onclick="limparEvidencias()">
                        <i class="icon-trash"></i> LIMPAR
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
