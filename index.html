<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VDC | Sistema de Peritagem Forense v5.2</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@300;400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Overlay de Carregamento -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner">
                <i class="fas fa-fingerprint fa-spin"></i>
            </div>
            <h2>VDC SISTEMA DE PERITAGEM FORENSE</h2>
            <p>Versão 5.2 | Inicializando Terminal de Prova Legal...</p>
            <div class="loading-progress">
                <div class="loading-progress-bar" id="loadingProgress"></div>
            </div>
        </div>
    </div>

    <!-- Mensagem de Erro -->
    <div id="errorMessage" class="error-message" style="display: none;">
        <div class="error-content">
            <i class="fas fa-exclamation-triangle"></i>
            <span id="errorText">Erro no sistema</span>
            <button class="error-close" onclick="document.getElementById('errorMessage').style.display='none'">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <!-- Conteúdo Principal -->
    <div id="mainContainer" class="main-container" style="display: none;">
        
        <!-- Cabeçalho -->
        <header class="main-header">
            <div class="header-content">
                <div class="logo-section">
                    <i class="fas fa-balance-scale"></i>
                    <h1>VDC | <span class="version-badge">v5.2</span></h1>
                </div>
                <div class="session-info">
                    <div class="session-id">
                        <i class="fas fa-id-card"></i>
                        <span>Sessão: <strong id="sessionIdDisplay">VDC-XXXXXX</strong></span>
                    </div>
                    <div class="timestamp">
                        <i class="fas fa-clock"></i>
                        <span id="currentTime">00:00:00</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Identificação do Cliente -->
        <section class="identification-section">
            <div class="identification-card">
                <div class="card-header">
                    <i class="fas fa-user-tie"></i>
                    <h3>IDENTIFICAÇÃO DO CLIENTE</h3>
                </div>
                <div class="identification-form">
                    <div class="form-group">
                        <label for="clientName"><i class="fas fa-user"></i> Nome do Cliente</label>
                        <input type="text" id="clientName" placeholder="Ex: Empresa XYZ, Lda">
                    </div>
                    <div class="form-group">
                        <label for="clientNIF"><i class="fas fa-id-card"></i> NIF</label>
                        <input type="text" id="clientNIF" placeholder="Ex: 123456789" maxlength="9">
                    </div>
                    <button id="registerClientBtn" class="primary-btn">
                        <i class="fas fa-save"></i> REGISTAR CLIENTE
                    </button>
                </div>
                <div id="clientStatus" class="client-status" style="display: none;">
                    <i class="fas fa-check-circle"></i>
                    <span>Cliente registado: <strong id="clientNameDisplay"></strong></span>
                </div>
            </div>
        </section>

        <!-- PASSO 1: Control File -->
        <section class="step-section step-1">
            <div class="step-header">
                <div class="step-number">1</div>
                <div class="step-title">
                    <h3>CARREGAR FICHEIRO DE CONTROLO</h3>
                    <small>Arraste ou clique para carregar o ficheiro CSV com hashes de referência</small>
                </div>
            </div>
            <div class="step-content">
                <div id="controlUploadArea" class="file-upload-area">
                    <div class="upload-icon">
                        <i class="fas fa-file-csv"></i>
                    </div>
                    <div class="upload-text">
                        <strong>Clique ou arraste o ficheiro CSV</strong>
                        <p>Formato aceite: .csv | Tamanho máximo: 10MB</p>
                    </div>
                </div>
                <input type="file" id="controlFile" class="file-input" accept=".csv">
                
                <div id="controlStatus" class="status-display status-pending">
                    <div class="status-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="status-text">
                        Aguardando ficheiro de controlo
                    </div>
                </div>
            </div>
        </section>

        <!-- PASSO 2: Documentos -->
        <section class="step-section">
            <div class="step-header">
                <div class="step-number">2</div>
                <div class="step-title">
                    <h3>CARREGAR DOCUMENTOS PARA VALIDAÇÃO</h3>
                    <small>Carregue os documentos correspondentes às hashes do ficheiro de controlo</small>
                </div>
            </div>
            
            <div id="documentsGrid" class="documents-grid" style="opacity: 0.5; pointer-events: none;">
                
                <!-- SAF-T -->
                <div class="document-card" data-type="saft">
                    <div class="card-header">
                        <div class="card-step">2.1</div>
                        <h4><i class="fas fa-file-invoice"></i> SAF-T / XML</h4>
                    </div>
                    <div class="card-body">
                        <div class="upload-container">
                            <div id="saftUploadArea" class="upload-area">
                                <i class="fas fa-file-upload"></i>
                                <p>Clique para carregar SAF-T</p>
                                <small>Formatos: .xml, .csv</small>
                            </div>
                            <input type="file" id="saftFile" class="file-input" accept=".xml,.csv" disabled>
                        </div>
                        <div class="validation-status">
                            <div class="status-indicator status-pending"></div>
                            <span id="saftStatus">Aguardando validação</span>
                        </div>
                        <div id="saftHashDisplay" class="hash-display" style="display: none;">
                            <div class="hash-label">HASH CALCULADA:</div>
                            <div id="saftHashValue" class="hash-value"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Fatura -->
                <div class="document-card" data-type="fatura">
                    <div class="card-header">
                        <div class="card-step">2.2</div>
                        <h4><i class="fas fa-file-invoice-dollar"></i> Fatura</h4>
                    </div>
                    <div class="card-body">
                        <div class="upload-container">
                            <div id="faturaUploadArea" class="upload-area">
                                <i class="fas fa-file-upload"></i>
                                <p>Clique para carregar Fatura</p>
                                <small>Formatos: .pdf, .xml, .csv</small>
                            </div>
                            <input type="file" id="faturaFile" class="file-input" accept=".pdf,.xml,.csv" disabled>
                        </div>
                        <div class="validation-status">
                            <div class="status-indicator status-pending"></div>
                            <span id="faturaStatus">Aguardando validação</span>
                        </div>
                        <div id="faturaHashDisplay" class="hash-display" style="display: none;">
                            <div class="hash-label">HASH CALCULADA:</div>
                            <div id="faturaHashValue" class="hash-value"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Extrato Bancário -->
                <div class="document-card" data-type="extrato">
                    <div class="card-header">
                        <div class="card-step">2.3</div>
                        <h4><i class="fas fa-university"></i> Extrato Bancário</h4>
                    </div>
                    <div class="card-body">
                        <div class="upload-container">
                            <div id="extratoUploadArea" class="upload-area">
                                <i class="fas fa-file-upload"></i>
                                <p>Clique para carregar Extrato</p>
                                <small>Formatos: .pdf, .csv, .txt</small>
                            </div>
                            <input type="file" id="extratoFile" class="file-input" accept=".pdf,.csv,.txt" disabled>
                        </div>
                        <div class="validation-status">
                            <div class="status-indicator status-pending"></div>
                            <span id="extratoStatus">Aguardando validação</span>
                        </div>
                        <div id="extratoHashDisplay" class="hash-display" style="display: none;">
                            <div class="hash-label">HASH CALCULADA:</div>
                            <div id="extratoHashValue" class="hash-value"></div>
                        </div>
                    </div>
                </div>
                
            </div>
        </section>

        <!-- Controles de Análise -->
        <section class="analysis-controls">
            <div class="controls-container">
                <button id="analyzeBtn" class="analyze-btn" disabled>
                    <i class="fas fa-search"></i> EXECUTAR ANÁLISE FORENSE
                </button>
                
                <div class="secondary-controls">
                    <button id="clearSessionBtn" class="secondary-btn">
                        <i class="fas fa-redo"></i> NOVA SESSÃO
                    </button>
                    <button id="exportLogsBtn" class="secondary-btn">
                        <i class="fas fa-download"></i> EXPORTAR LOGS
                    </button>
                    <button id="clearConsoleBtn" class="secondary-btn">
                        <i class="fas fa-broom"></i> LIMPAR CONSOLE
                    </button>
                </div>
                
                <div id="progressContainer" class="progress-container" style="display: none;">
                    <div id="progressBar" class="progress-bar"></div>
                    <div id="progressText" class="progress-text">0%</div>
                </div>
            </div>
        </section>

        <!-- Console de Auditoria -->
        <section class="audit-section">
            <div class="audit-header">
                <h4><i class="fas fa-terminal"></i> CONSOLE DE AUDITORIA</h4>
                <div class="audit-controls">
                    <button class="icon-btn" title="Copiar logs" onclick="copyConsole()">
                        <i class="fas fa-copy"></i>
                    </button>
                    <button class="icon-btn" title="Expandir" onclick="toggleConsole()">
                        <i class="fas fa-expand"></i>
                    </button>
                </div>
            </div>
            <div id="auditOutput" class="audit-output">
                <!-- Logs serão inseridos aqui -->
            </div>
        </section>

        <!-- Rodapé -->
        <footer class="main-footer">
            <div class="footer-content">
                <div class="system-info">
                    <div class="master-hash">
                        <strong>MASTER HASH DA SESSÃO:</strong>
                        <span id="masterHashValue">AGUARDANDO GERAÇÃO...</span>
                    </div>
                    <div class="copyright">
                        <i class="fas fa-shield-alt"></i> VDC Sistema de Peritagem Forense v5.2 | © 2024 Todos os direitos reservados
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <script src="script.js"></script>
</body>
</html>
