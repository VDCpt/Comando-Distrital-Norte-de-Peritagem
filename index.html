<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="VDC Forense - Sistema de Peritagem Digital v13.6 MASTER SCHEMA (UNIFICADO)">
    <title>VDC FORENSE - v13.6 MASTER SCHEMA (UNIFICADO)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- BARREIRA DE ENTRADA - ACESSO RESTRITO (v13.0 + v13.1) -->
    <div id="barrier-window" class="modal-overlay">
        <div class="modal-content barrier-box">
            <div class="modal-header">
                <div class="security-badge">ACESSO RESTRITO ¬∑ N√çVEL 4</div>
                <h2>VDC FORENSE v13.6</h2>
                <p>Sistema de Auditoria Digital e An√°lise Fiscal ¬∑ MASTER SCHEMA</p>
            </div>
            <div class="modal-body">
                <div class="perito-info">
                    <p><strong>ANALISTA:</strong> PERITO FORENSE DIGITAL</p>
                    <p><strong>ENTIDADE:</strong> CONSULTORIA DE GEST√ÉO E I&D</p>
                    <p><strong>ALVO:</strong> AUDITORIA ECON√ìMICO-FINANCEIRA ¬∑ DAC7/SAF-T</p>
                </div>
                <p class="disclaimer">O sistema ir√° processar fontes brutas (PDF, CSV, XML, JSON) para gera√ß√£o de prova legal de autenticidade (SHA-256) e cruzamento de dados fiscais. Todas as opera√ß√µes s√£o registadas na cadeia de cust√≥dia.</p>
                <div class="auth-hash" id="session-id-display">
                    <span class="hash-label">HASH DA SESS√ÉO:</span>
                    <span class="hash-value" id="sessionHash">---</span>
                </div>
            </div>
            <div class="modal-footer">
                <button id="btn-proceed" class="btn-primary-glow">VALIDAR ACESSO E INICIAR SESS√ÉO</button>
            </div>
        </div>
    </div>

    <!-- APLICA√á√ÉO PRINCIPAL (INICIALMENTE OCULTA) -->
    <div id="app-container" class="hidden">
        <header class="main-header">
            <div class="brand">
                <div class="logo-icon">VDC</div>
                <div class="brand-text">
                    <h1>SISTEMA <span>MASTER SCHEMA</span> <span class="version-badge">v13.6</span></h1>
                    <div class="session-info">
                        SESS√ÉO: <span id="session-id">---</span> | 
                        <span id="session-time">00:00:00</span> | 
                        <span class="status-online">ONLINE</span>
                    </div>
                </div>
            </div>
            <div class="header-actions">
                <button id="btn-demo" class="btn-tool">CARREGAR DEMO</button>
                <button id="btn-export-json" class="btn-tool">EXPORTAR JSON</button>
                <button id="btn-clear" class="btn-tool btn-tool-danger">LIMPAR SISTEMA</button>
            </div>
        </header>

        <main class="dashboard-grid">
            <!-- SIDEBAR ESQUERDA - CONSOLA E UPLOAD -->
            <aside class="sidebar">
                <!-- CONSOLA DE AUDITORIA -->
                <section class="card console-card">
                    <div class="card-header">
                        <h3>CONSOLA DE AUDITORIA ¬∑ CADEIA DE CUST√ìDIA</h3>
                        <span class="status-dot pulse"></span>
                    </div>
                    <div id="audit-console" class="terminal-box">
                        <div class="line green">[SISTEMA] A aguardar fontes de dados...</div>
                        <div class="line blue">[INFO] Utilize a zona de upload para anexar documentos</div>
                    </div>
                </section>

                <!-- ZONA DE UPLOAD - FONTES DE DADOS (v13.1 + v13.6) -->
                <section class="card upload-card">
                    <h3>FONTES DE DADOS ¬∑ UPLOAD</h3>
                    
                    <!-- METADADOS DA PER√çCIA (v13.1 + v13.6) -->
                    <div class="metadata-audit">
                        <div class="metadata-item">
                            <label>Sujeito Passivo / Empresa:</label>
                            <input type="text" id="subjectName" placeholder="Nome da Entidade" class="input-forense">
                        </div>
                        <div class="metadata-item">
                            <label>NIPC / NIF:</label>
                            <input type="text" id="nipc" placeholder="N√∫mero de Identifica√ß√£o Fiscal" class="input-forense" maxlength="9">
                        </div>
                        <div class="metadata-item">
                            <label>Plataforma TVDE:</label>
                            <select id="platform" class="select-forense">
                                <option value="">-- Selecione a Plataforma --</option>
                                <option value="uber">Uber B.V.</option>
                                <option value="bolt">Bolt Operations O√ú</option>
                                <option value="outra">Outra Plataforma</option>
                            </select>
                            <div id="platformDetails" class="platform-details"></div>
                        </div>
                        <div class="metadata-row">
                            <div class="metadata-half">
                                <label>Ano Fiscal:</label>
                                <select id="fiscalYear" class="select-forense"></select>
                            </div>
                            <div class="metadata-half">
                                <label>Per√≠odo:</label>
                                <select id="fiscalPeriod" class="select-forense">
                                    <option value="Anual">Anual</option>
                                    <option value="1.¬∫ Trimestre">1.¬∫ Trimestre</option>
                                    <option value="2.¬∫ Trimestre">2.¬∫ Trimestre</option>
                                    <option value="3.¬∫ Trimestre">3.¬∫ Trimestre</option>
                                    <option value="4.¬∫ Trimestre">4.¬∫ Trimestre</option>
                                    <option value="Mensal">Mensal</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ZONA DE DROP (v13.0) -->
                    <div class="drop-zone" id="drop-zone">
                        <span class="drop-icon">üìÅ</span>
                        <p>Arraste ficheiros ou clique para selecionar</p>
                        <small>Formatos suportados: PDF, CSV, XML, JSON (m√°x. 10MB)</small>
                        <input type="file" id="file-input" multiple accept=".pdf,.csv,.xml,.json,application/pdf,text/csv,application/json" hidden>
                    </div>
                    
                    <!-- LISTA DE FICHEIROS (v13.0 + v13.1) -->
                    <div id="file-queue" class="file-list-mini">
                        <!-- Ficheiros ser√£o listados aqui dinamicamente -->
                    </div>
                    
                    <!-- CONTADOR DE DOCUMENTOS (v13.6) -->
                    <div class="counter-box">Documentos no Lote: <span id="doc-count">0</span></div>
                    
                    <!-- SUM√ÅRIO DE EVID√äNCIAS (v13.0) -->
                    <div class="evidence-summary">
                        <div class="evidence-item" data-tipo="ctrl">
                            <span class="count" id="count-ctrl">0</span>
                            <span class="label">CTRL</span>
                        </div>
                        <div class="evidence-item" data-tipo="saft">
                            <span class="count" id="count-saft">0</span>
                            <span class="label">SAF-T</span>
                        </div>
                        <div class="evidence-item" data-tipo="fat">
                            <span class="count" id="count-fat">0</span>
                            <span class="label">FAT</span>
                        </div>
                        <div class="evidence-item" data-tipo="ext">
                            <span class="count" id="count-ext">0</span>
                            <span class="label">EXT</span>
                        </div>
                        <div class="evidence-item" data-tipo="dac7">
                            <span class="count" id="count-dac7">0</span>
                            <span class="label">DAC7</span>
                        </div>
                    </div>
                    
                    <!-- BOT√ÉO ANALISAR (v13.0 + v13.6) -->
                    <div class="actions" style="margin-top: 15px;">
                        <button id="btn-analyze" class="btn-primary">EXECUTAR CRUZAMENTOS</button>
                    </div>
                </section>
            </aside>

            <!-- CONTE√öDO PRINCIPAL - M√âTRICAS E RESULTADOS -->
            <section class="main-content">
                <!-- M√âTRICAS PRINCIPAIS (v13.0) -->
                <div class="metrics-grid">
                    <div class="metric-card">
                        <label>RECEITA BRUTA (SAF-T)</label>
                        <div class="value positive" id="val-bruto">0,00 ‚Ç¨</div>
                    </div>
                    <div class="metric-card">
                        <label>GANHOS L√çQUIDOS (BOLT)</label>
                        <div class="value positive" id="val-liquido">0,00 ‚Ç¨</div>
                    </div>
                    <div class="metric-card">
                        <label>RECEITA ANUAL (DAC7)</label>
                        <div class="value positive" id="val-dac7">0,00 ‚Ç¨</div>
                    </div>
                </div>

                <!-- M√âTRICAS SECUND√ÅRIAS (v13.0) -->
                <div class="metrics-grid secondary">
                    <div class="metric-card small">
                        <label>COMISS√ïES TOTAIS</label>
                        <div class="value" id="val-comissoes">0,00 ‚Ç¨</div>
                    </div>
                    <div class="metric-card small">
                        <label>N.¬∫ VIAGENS</label>
                        <div class="value" id="val-viagens">0</div>
                    </div>
                    <div class="metric-card small">
                        <label>TAXA M√âDIA</label>
                        <div class="value" id="val-taxa">0,00%</div>
                    </div>
                </div>

                <!-- √ÅREA DE ALERTAS CR√çTICOS (v13.0) -->
                <section class="card alerts-card">
                    <div class="card-header">
                        <h3>ALERTAS DE DISCREP√ÇNCIA ¬∑ CRUZAMENTOS ARITM√âTICOS</h3>
                        <span class="status-dot warning-pulse"></span>
                    </div>
                    <div id="alertas-container" class="alertas-container">
                        <!-- Alertas ser√£o inseridos dinamicamente -->
                    </div>
                </section>

                <!-- PAINEL DE RESULTADOS COM TABS (v13.0) -->
                <div class="card results-card">
                    <div class="tabs">
                        <button class="tab-btn active" data-tab="tab-autenticidade">CONTROLO DE AUTENTICIDADE (SHA-256)</button>
                        <button class="tab-btn" data-tab="tab-financeiro">CRUZAMENTO FINANCEIRO</button>
                        <button class="tab-btn" data-tab="tab-dac7">RELAT√ìRIO DAC7</button>
                        <button class="tab-btn" data-tab="tab-veredito">VEREDITO FISCAL</button>
                    </div>

                    <!-- TAB 1: AUTENTICIDADE / HASHES (v13.0) -->
                    <div class="tab-content" id="tab-autenticidade">
                        <div class="table-wrapper">
                            <table id="table-hashes">
                                <thead>
                                    <tr>
                                        <th>ALGORITMO</th>
                                        <th>HASH CALCULADO (SHA-256)</th>
                                        <th>FICHEIRO ORIGEM</th>
                                        <th>ESTADO</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Linhas inseridas via JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        <div class="table-footer">
                            <span class="hash-verified">‚úì Todos os ficheiros verificados por hash</span>
                        </div>
                        <div class="master-hash-container">
                            <span class="master-hash-label">MASTER HASH SHA-256:</span>
                            <span id="master-hash" class="master-hash-value">---</span>
                        </div>
                    </div>

                    <!-- TAB 2: CRUZAMENTO FINANCEIRO (v13.0 + v13.6) -->
                    <div class="tab-content hidden" id="tab-financeiro">
                        <div class="table-wrapper">
                            <table id="table-viagens">
                                <thead>
                                    <tr>
                                        <th>DATA</th>
                                        <th>MOTORISTA</th>
                                        <th>N.¬∫ FATURA</th>
                                        <th>VALOR (‚Ç¨)</th>
                                        <th>COMISS√ÉO (‚Ç¨)</th>
                                        <th>TAXA</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Linhas inseridas via JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        <div class="triangulacao-financeira">
                            <h4>TRIANGULA√á√ÉO FINANCEIRA - VERDADE MATERIAL</h4>
                            <div class="triangulacao-grid">
                                <div class="tri-item">
                                    <span>BRUTO APP</span>
                                    <strong id="tri-bruto">0,00 ‚Ç¨</strong>
                                </div>
                                <div class="tri-item">
                                    <span>COMISS√ïES</span>
                                    <strong id="tri-comissoes">0,00 ‚Ç¨</strong>
                                </div>
                                <div class="tri-item">
                                    <span>PROVEITO REAL</span>
                                    <strong id="tri-liquido">0,00 ‚Ç¨</strong>
                                </div>
                                <div class="tri-item">
                                    <span>FATURADO</span>
                                    <strong id="tri-faturado">0,00 ‚Ç¨</strong>
                                </div>
                                <div class="tri-item" id="tri-discrepancia-item" style="display: none;">
                                    <span>DISCREP√ÇNCIA</span>
                                    <strong id="tri-discrepancia">0,00 ‚Ç¨</strong>
                                </div>
                            </div>
                        </div>
                        
                        <!-- DETALHES DOS CRUZAMENTOS (v13.0) -->
                        <div class="cruzamentos-detalhe">
                            <h4>RESULTADOS DOS CRUZAMENTOS</h4>
                            <div class="cruzamento-item" id="cruzamento-saft-dac7">
                                <span class="cruzamento-label">SAF-T vs DAC7:</span>
                                <span class="cruzamento-status" id="status-saft-dac7">A aguardar dados</span>
                                <span id="tri-saft-dac7" style="display: none;"></span>
                            </div>
                            <div class="cruzamento-item" id="cruzamento-bruto-extrato">
                                <span class="cruzamento-label">Bruto vs Ganhos App:</span>
                                <span class="cruzamento-status" id="status-bruto-extrato">A aguardar dados</span>
                                <span id="tri-bruto-extrato" style="display: none;"></span>
                            </div>
                            <div class="cruzamento-item" id="cruzamento-comissoes-faturas">
                                <span class="cruzamento-label">Comiss√µes vs Faturas:</span>
                                <span class="cruzamento-status" id="status-comissoes-faturas">A aguardar dados</span>
                                <span id="tri-comissoes-faturas" style="display: none;"></span>
                            </div>
                        </div>
                    </div>

                    <!-- TAB 3: RELAT√ìRIO DAC7 (v13.0) -->
                    <div class="tab-content hidden" id="tab-dac7">
                        <div class="dac7-container">
                            <div class="dac7-header">
                                <h4>DECLARA√á√ÉO ANUAL ¬∑ DIRETIVA DAC7</h4>
                                <span class="dac7-badge">ART. 6.¬∫</span>
                            </div>
                            <div class="dac7-content">
                                <div class="dac7-row">
                                    <span>RECEITA TOTAL DECLARADA:</span>
                                    <strong id="dac7-receita">0,00 ‚Ç¨</strong>
                                </div>
                                <div class="dac7-row">
                                    <span>COMISS√ïES TOTAIS:</span>
                                    <strong id="dac7-comissoes">0,00 ‚Ç¨</strong>
                                </div>
                                <div class="dac7-row">
                                    <span>SERVI√áOS PRESTADOS:</span>
                                    <strong id="dac7-servicos">0</strong>
                                </div>
                                <div class="dac7-row">
                                    <span>PER√çODO DECLARADO:</span>
                                    <strong id="dac7-periodo">2024</strong>
                                </div>
                            </div>
                            <div class="dac7-trimestres">
                                <h5>DETALHES TRIMESTRAIS</h5>
                                <div class="trimestres-grid">
                                    <div class="trimestre-card">
                                        <span class="trimestre-label">1.¬∫ TRIMESTRE</span>
                                        <span class="trimestre-value" id="dac7-1t">0,00 ‚Ç¨</span>
                                    </div>
                                    <div class="trimestre-card">
                                        <span class="trimestre-label">2.¬∫ TRIMESTRE</span>
                                        <span class="trimestre-value" id="dac7-2t">0,00 ‚Ç¨</span>
                                    </div>
                                    <div class="trimestre-card">
                                        <span class="trimestre-label">3.¬∫ TRIMESTRE</span>
                                        <span class="trimestre-value" id="dac7-3t">0,00 ‚Ç¨</span>
                                    </div>
                                    <div class="trimestre-card">
                                        <span class="trimestre-label">4.¬∫ TRIMESTRE</span>
                                        <span class="trimestre-value" id="dac7-4t">0,00 ‚Ç¨</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- TAB 4: VEREDITO FISCAL (v13.0) -->
                    <div class="tab-content hidden" id="tab-veredito">
                        <div class="veredicto-section" id="veredicto-section">
                            <div class="veredicto-header">
                                <h2>VEREDITO FISCAL ¬∑ TRIANGULA√á√ÉO</h2>
                                <div class="veredicto-status" id="veredicto-status">NORMAL</div>
                                <div class="veredicto-desvio" id="veredicto-desvio">Sem desvios significativos</div>
                            </div>
                            <div class="anomalia-critica" id="anomalia-critica" style="display: none;">
                                <span class="icon-warning">‚ö†</span>
                                <div>
                                    <strong>ANOMALIA CR√çTICA DETETADA</strong>
                                    <p id="anomalia-texto">Potencial incumprimento fiscal (Art. 103.¬∫ RGIT)</p>
                                    <span class="valor-anomalia" id="valor-anomalia">0,00 ‚Ç¨</span>
                                </div>
                            </div>
                            <div class="recomendacoes">
                                <h4>RECOMENDA√á√ïES T√âCNICAS</h4>
                                <ul id="recomendacoes-lista">
                                    <li>Validar concilia√ß√£o banc√°ria dos valores declarados</li>
                                    <li>Verificar reten√ß√µes na fonte e IVA</li>
                                    <li>Confrontar valores com extratos banc√°rios</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- BOT√ÉO EXPORTAR RELAT√ìRIO PERICIAL (v13.0 + v13.6) -->
                <div style="margin-top: 15px; text-align: right;">
                    <button id="btn-export-pdf" class="btn-secondary">EXPORTAR RELAT√ìRIO PERICIAL (PDF)</button>
                </div>
            </section>
        </main>

        <footer class="main-footer">
            <div class="status-bar">
                <span><strong>ESTADO:</strong> <span id="system-status" class="status-ok">OPERACIONAL</span></span>
                <span><strong>SESS√ÉO:</strong> <span id="footer-session">---</span></span>
                <span><strong>VERS√ÉO:</strong> 13.6.0-FINAL ¬∑ MASTER SCHEMA</span>
                <span><strong>DATA:</strong> <span id="footer-date"></span></span>
            </div>
        </footer>
    </div>

    <!-- SCRIPTS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
